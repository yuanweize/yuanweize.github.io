<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>72.Pandas的应用-3 | HExLL-迷雾日志</title><meta name="keywords" content="Python,Day66-80"><meta name="author" content="GreenSeaa"><meta name="copyright" content="GreenSeaa"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="Pandas的应用-3 DataFrame的应用 数据清洗 通常，我们从 Excel、CSV 或数据库中获取到的数据并不是非常完美的，里面可能因为系统或人为的原因混入了重复值或异常值，也可能在某些字段上存在缺失值；再者，DataFrame中的数据也可能存在格式不统一、量纲不统一等各种问题。因此，在开始数据分析之前，对数据进行清洗就显得特别重要。 缺失值 可以使用DataFrame对象的isnull">
<meta property="og:type" content="article">
<meta property="og:title" content="72.Pandas的应用-3">
<meta property="og:url" content="https://yuanweize.github.io/2022/08/09/Python-100-Days/Day66-80/72.Pandas%E7%9A%84%E5%BA%94%E7%94%A8-3/index.html">
<meta property="og:site_name" content="HExLL-迷雾日志">
<meta property="og:description" content="Pandas的应用-3 DataFrame的应用 数据清洗 通常，我们从 Excel、CSV 或数据库中获取到的数据并不是非常完美的，里面可能因为系统或人为的原因混入了重复值或异常值，也可能在某些字段上存在缺失值；再者，DataFrame中的数据也可能存在格式不统一、量纲不统一等各种问题。因此，在开始数据分析之前，对数据进行清洗就显得特别重要。 缺失值 可以使用DataFrame对象的isnull">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
<meta property="article:published_time" content="2022-08-09T05:39:47.000Z">
<meta property="article:modified_time" content="2022-08-09T15:08:27.352Z">
<meta property="article:author" content="GreenSeaa">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="Day66-80">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://yuanweize.github.io/2022/08/09/Python-100-Days/Day66-80/72.Pandas%E7%9A%84%E5%BA%94%E7%94%A8-3/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-WD3QXC5CQE"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-WD3QXC5CQE');
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"SW7OVVVFHX","apiKey":"5d05023a8579462e72ea704e4f43cf3f","indexName":"hexo","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '72.Pandas的应用-3',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '09-08-2022 17:08:27'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.2.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s.gravatar.com/avatar/50de7ee8a1fc96ada7495a641400642d?s=512" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">803</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">75</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">72</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://app.plex.tv/"><i class="fa-fw fas fa-video"></i><span> Movie[PLEX]</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://command.yuanweize.win/"><i class="fa-fw fab fa-linux"></i><span> Linux-command</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">HExLL-迷雾日志</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://app.plex.tv/"><i class="fa-fw fas fa-video"></i><span> Movie[PLEX]</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://command.yuanweize.win/"><i class="fa-fw fab fa-linux"></i><span> Linux-command</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">72.Pandas的应用-3</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-08-09T05:39:47.000Z" title="发表于 09-08-2022 07:39:47">09-08-2022</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-08-09T15:08:27.352Z" title="更新于 09-08-2022 17:08:27">09-08-2022</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Python-100-Days/">Python-100-Days</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Python-100-Days/Day66-80/">Day66-80</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>19分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="72.Pandas的应用-3"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="Pandas的应用-3">Pandas的应用-3</h2>
<h3 id="DataFrame的应用-2">DataFrame的应用</h3>
<h4 id="数据清洗">数据清洗</h4>
<p>通常，我们从 Excel、CSV 或数据库中获取到的数据并不是非常完美的，里面可能因为系统或人为的原因混入了重复值或异常值，也可能在某些字段上存在缺失值；再者，<code>DataFrame</code>中的数据也可能存在格式不统一、量纲不统一等各种问题。因此，在开始数据分析之前，对数据进行清洗就显得特别重要。</p>
<h5 id="缺失值">缺失值</h5>
<p>可以使用<code>DataFrame</code>对象的<code>isnull</code>或<code>isna</code>方法来找出数据表中的缺失值，如下所示。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">emp_df.isnull()</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">emp_df.isna()</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">        ename   job	    mgr     sal     comm    dno</span><br><span class="line">eno						</span><br><span class="line">1359	False	False	False	False	False	False</span><br><span class="line">2056	False	False	False	False	False	False</span><br><span class="line">3088	False	False	False	False	False	False</span><br><span class="line">3211	False	False	False	False	True	False</span><br><span class="line">3233	False	False	False	False	True	False</span><br><span class="line">3244	False	False	False	False	True	False</span><br><span class="line">3251	False	False	False	False	True	False</span><br><span class="line">3344	False	False	False	False	False	False</span><br><span class="line">3577	False	False	False	False	True	False</span><br><span class="line">3588	False	False	False	False	True	False</span><br><span class="line">4466	False	False	False	False	True	False</span><br><span class="line">5234	False	False	False	False	True	False</span><br><span class="line">5566	False	False	False	False	False	False</span><br><span class="line">7800	False	False	True	False	False	False</span><br></pre></td></tr></table></figure>
<p>相对应的，<code>notnull</code>和<code>notna</code>方法可以将非空的值标记为<code>True</code>。如果想删除这些缺失值，可以使用<code>DataFrame</code>对象的<code>dropna</code>方法，该方法的<code>axis</code>参数可以指定沿着0轴还是1轴删除，也就是说当遇到空值时，是删除整行还是删除整列，默认是沿0轴进行删除的，代码如下所示。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">emp_df.dropna()</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">        ename   job      mgr	 sal    comm     dno</span><br><span class="line">eno						</span><br><span class="line">1359	胡一刀  销售员	3344.0	1800   200.0	30</span><br><span class="line">2056	乔峰    架构师	 7800.0	 5000	1500.0	 20</span><br><span class="line">3088	李莫愁  设计师	2056.0	3500   800.0	20</span><br><span class="line">3344	黄蓉    销售主管	7800.0	3000   800.0	30</span><br><span class="line">5566	宋远桥  会计师	7800.0	4000   1000.0	10</span><br></pre></td></tr></table></figure>
<p>如果要沿着1轴进行删除，可以使用下面的代码。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">emp_df.dropna(axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">        ename    job      sal    dno</span><br><span class="line">eno				</span><br><span class="line">1359	胡一刀   销售员    1800	30</span><br><span class="line">2056	乔峰     架构师	  5000	 20</span><br><span class="line">3088	李莫愁   设计师    3500	20</span><br><span class="line">3211	张无忌   程序员    3200	20</span><br><span class="line">3233	丘处机   程序员    3400	20</span><br><span class="line">3244	欧阳锋   程序员    3200	20</span><br><span class="line">3251	张翠山   程序员    4000	20</span><br><span class="line">3344	黄蓉     销售主管  3000	30</span><br><span class="line">3577	杨过     会计	   2200	  10</span><br><span class="line">3588	朱九真   会计	  2500	 10</span><br><span class="line">4466	苗人凤   销售员	 2500   30</span><br><span class="line">5234	郭靖     出纳      2000   10</span><br><span class="line">5566	宋远桥   会计师    4000   10</span><br><span class="line">7800	张三丰   总裁      9000   20</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意</strong>：<code>DataFrame</code>对象的很多方法都有一个名为<code>inplace</code>的参数，该参数的默认值为<code>False</code>，表示我们的操作不会修改原来的<code>DataFrame</code>对象，而是将处理后的结果通过一个新的<code>DataFrame</code>对象返回。如果将该参数的值设置为<code>True</code>，那么我们的操作就会在原来的<code>DataFrame</code>上面直接修改，方法的返回值为<code>None</code>。简单的说，上面的操作并没有修改<code>emp_df</code>，而是返回了一个新的<code>DataFrame</code>对象。</p>
</blockquote>
<p>在某些特定的场景下，我们可以对空值进行填充，对应的方法是<code>fillna</code>，填充空值时可以使用指定的值（通过<code>value</code>参数进行指定），也可以用表格中前一个单元格（通过设置参数<code>method=ffill</code>）或后一个单元格（通过设置参数<code>method=bfill</code>）的值进行填充，当代码如下所示。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">emp_df.fillna(value=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意</strong>：填充的值如何选择也是一个值得探讨的话题，实际工作中，可能会使用某种统计量（如：均值、众数等）进行填充，或者使用某种插值法（如：随机插值法、拉格朗日插值法等）进行填充，甚至有可能通过回归模型、贝叶斯模型等对缺失数据进行填充。</p>
</blockquote>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">        ename    job        mgr      sal     comm    dno</span><br><span class="line">eno</span><br><span class="line">1359	胡一刀    销售员	   3344.0	1800	200.0	30</span><br><span class="line">2056	乔峰	    分析师	    7800.0	 5000	 1500.0	 20</span><br><span class="line">3088	李莫愁	   设计师	   2056.0	3500	800.0	20</span><br><span class="line">3211	张无忌	   程序员	   2056.0	3200	0.0     20</span><br><span class="line">3233	丘处机	   程序员	   2056.0	3400	0.0	    20</span><br><span class="line">3244	欧阳锋	   程序员	   3088.0	3200	0.0     20</span><br><span class="line">3251	张翠山	   程序员	   2056.0	4000	0.0	    20</span><br><span class="line">3344	黄蓉	    销售主管   7800.0	3000	800.0	30</span><br><span class="line">3577	杨过	    会计	     5566.0	  2200	  0.0	  10</span><br><span class="line">3588	朱九真	   会计	    5566.0	 2500	 0.0	 10</span><br><span class="line">4466	苗人凤	   销售员	   3344.0	2500	0.0	    30</span><br><span class="line">5234	郭靖	    出纳	     5566.0	  2000	  0.0	  10</span><br><span class="line">5566	宋远桥	   会计师	   7800.0	4000	1000.0	10</span><br><span class="line">7800	张三丰	   总裁	    0.0      9000	 1200.0	 20</span><br></pre></td></tr></table></figure>
<h5 id="重复值">重复值</h5>
<p>接下来，我们先给之前的部门表添加两行数据，让部门表中名为“研发部”和“销售部”的部门各有两个。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dept_df.loc[<span class="number">50</span>] = &#123;<span class="string">&#x27;dname&#x27;</span>: <span class="string">&#x27;研发部&#x27;</span>, <span class="string">&#x27;dloc&#x27;</span>: <span class="string">&#x27;上海&#x27;</span>&#125;</span><br><span class="line">dept_df.loc[<span class="number">60</span>] = &#123;<span class="string">&#x27;dname&#x27;</span>: <span class="string">&#x27;销售部&#x27;</span>, <span class="string">&#x27;dloc&#x27;</span>: <span class="string">&#x27;长沙&#x27;</span>&#125;</span><br><span class="line">dept_df</span><br></pre></td></tr></table></figure>
<p>输出:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">    dname  dloc</span><br><span class="line">dno		</span><br><span class="line">10	会计部	北京</span><br><span class="line">20	研发部	成都</span><br><span class="line">30	销售部	重庆</span><br><span class="line">40	运维部	天津</span><br><span class="line">50	研发部	上海</span><br><span class="line">60	销售部	长沙</span><br></pre></td></tr></table></figure>
<p>现在，我们的数据表中有重复数据了，我们可以通过<code>DataFrame</code>对象的<code>duplicated</code>方法判断是否存在重复值，该方法在不指定参数时默认判断行索引是否重复，我们也可以指定根据部门名称<code>dname</code>判断部门是否重复，代码如下所示。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dept_df.duplicated(<span class="string">&#x27;dname&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dno</span><br><span class="line">10    False</span><br><span class="line">20    False</span><br><span class="line">30    False</span><br><span class="line">40    False</span><br><span class="line">50     True</span><br><span class="line">60     True</span><br><span class="line">dtype: bool</span><br></pre></td></tr></table></figure>
<p>从上面的输出可以看到，<code>50</code>和<code>60</code>两个部门从部门名称上来看是重复的，如果要删除重复值，可以使用<code>drop_duplicates</code>方法，该方法的<code>keep</code>参数可以控制在遇到重复值时，保留第一项还是保留最后一项，或者多个重复项一个都不用保留，全部删除掉。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dept_df.drop_duplicates(<span class="string">&#x27;dname&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">	dname	dloc</span><br><span class="line">dno		</span><br><span class="line">10	会计部	北京</span><br><span class="line">20	研发部	成都</span><br><span class="line">30	销售部	重庆</span><br><span class="line">40	运维部	天津</span><br></pre></td></tr></table></figure>
<p>将<code>keep</code>参数的值修改为<code>last</code>。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dept_df.drop_duplicates(<span class="string">&#x27;dname&#x27;</span>, keep=<span class="string">&#x27;last&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">	dname	dloc</span><br><span class="line">dno		</span><br><span class="line">10	会计部	北京</span><br><span class="line">40	运维部	天津</span><br><span class="line">50	研发部	上海</span><br><span class="line">60	销售部	长沙</span><br></pre></td></tr></table></figure>
<h5 id="异常值">异常值</h5>
<p>异常值在统计学上的全称是疑似异常值，也称作离群点（outlier），异常值的分析也称作离群点分析。异常值是指样本中出现的“极端值”，数据值看起来异常大或异常小，其分布明显偏离其余的观测值。实际工作中，有些异常值可能是由系统或人为原因造成的，但有些异常值却不是，它们能够重复且稳定的出现，属于正常的极端值，例如很多游戏产品中头部玩家的数据往往都是离群的极端值。所以，我们既不能忽视异常值的存在，也不能简单地把异常值从数据分析中剔除。重视异常值的出现，分析其产生的原因，常常成为发现问题进而改进决策的契机。</p>
<p>异常值的检测有Z-score 方法、IQR 方法、DBScan 聚类、孤立森林等，这里我们对前两种方法做一个简单的介绍。</p>
<img src="https://github.com/jackfrued/mypic/raw/master/20211004192858.png" style="zoom:50%;">
<p>如果数据服从正态分布，依据3σ法则，异常值被定义与平均值的偏差超过三倍标准差的值。在正态分布下，距离平均值3σ之外的值出现的概率为$ P(|x-\mu|&gt;3\sigma)&lt;0.003 $，属于小概率事件。如果数据不服从正态分布，那么可以用远离平均值的多少倍的标准差来描述，这里的倍数就是Z-score。Z-score以标准差为单位去度量某一原始分数偏离平均值的距离，公式如下所示。</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>z</mi><mo>=</mo><mfrac><mrow><mi>X</mi><mo>−</mo><mi>μ</mi></mrow><mi>σ</mi></mfrac></mrow><annotation encoding="application/x-tex">z = \frac {X - \mu} {\sigma}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">μ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>Z-score需要根据经验和实际情况来决定，通常把远离标准差<code>3</code>倍距离以上的数据点视为离群点，下面的代给出了如何通过Z-score方法检测异常值。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">detect_outliers_zscore</span>(<span class="params">data, threshold=<span class="number">3</span></span>):</span><br><span class="line">    avg_value = np.mean(data)</span><br><span class="line">    std_value = np.std(data)</span><br><span class="line">    z_score = np.<span class="built_in">abs</span>((data - avg_value) / std_value)</span><br><span class="line">    <span class="keyword">return</span> data[z_score &gt; threshold]</span><br></pre></td></tr></table></figure>
<p>IQR 方法中的IQR（Inter-Quartile Range）代表四分位距离，即上四分位数（Q3）和下四分位数（Q1）的差值。通常情况下，可以认为小于 $ Q1 - 1.5 \times IQR $ 或大于 $ Q3 + 1.5 \times IQR $ 的就是异常值，而这种检测异常值的方法也是箱线图（后面会讲到）默认使用的方法。下面的代给出了如何通过 IQR 方法检测异常值。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">detect_outliers_iqr</span>(<span class="params">data, whis=<span class="number">1.5</span></span>):</span><br><span class="line">    q1, q3 = np.quantile(data, [<span class="number">0.25</span>, <span class="number">0.75</span>])</span><br><span class="line">    iqr = q3 - q1</span><br><span class="line">    lower, upper = q1 - whis * iqr, q3 + whis * iqr</span><br><span class="line">    <span class="keyword">return</span> data[(data &lt; lower) | (data &gt; upper)]</span><br></pre></td></tr></table></figure>
<p>如果要删除异常值，可以使用<code>DataFrame</code>对象的<code>drop</code>方法，该方法可以根据行索引或列索引删除指定的行或列。例如我们认为月薪低于<code>2000</code>或高于<code>8000</code>的是员工表中的异常值，可以用下面的代码删除对应的记录。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">emp_df.drop(emp_df[(emp_df.sal &gt; <span class="number">8000</span>) | (emp_df.sal &lt; <span class="number">2000</span>)].index)</span><br></pre></td></tr></table></figure>
<p>如果要替换掉异常值，可以通过给单元格赋值的方式来实现，也可以使用<code>replace</code>方法将指定的值替换掉。例如我们要将月薪为<code>1800</code>和<code>9000</code>的替换为月薪的平均值，补贴为<code>800</code>的替换为<code>1000</code>，代码如下所示。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">avg_sal = np.mean(emp_df.sal).astype(<span class="built_in">int</span>)</span><br><span class="line">emp_df.replace(&#123;<span class="string">&#x27;sal&#x27;</span>: [<span class="number">1800</span>, <span class="number">9000</span>], <span class="string">&#x27;comm&#x27;</span>: <span class="number">800</span>&#125;, &#123;<span class="string">&#x27;sal&#x27;</span>: avg_sal, <span class="string">&#x27;comm&#x27;</span>: <span class="number">1000</span>&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="预处理">预处理</h5>
<p>对数据进行预处理也是一个很大的话题，它包含了对数据的拆解、变换、归约、离散化等操作。我们先来看看数据的拆解。如果数据表中的数据是一个时间日期，我们通常都需要从年、季度、月、日、星期、小时、分钟等维度对其进行拆解，如果时间日期是用字符串表示的，可以先通过<code>pandas</code>的<code>to_datetime</code>函数将其处理成时间日期。</p>
<p>在下面的例子中，我们先读取 Excel 文件，获取到一组销售数据，其中第一列就是销售日期，我们将其拆解为“月份”、“季度”和“星期”，代码如下所示。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sales_df = pd.read_excel(</span><br><span class="line">    <span class="string">&#x27;2020年销售数据.xlsx&#x27;</span>,</span><br><span class="line">    usecols=[<span class="string">&#x27;销售日期&#x27;</span>, <span class="string">&#x27;销售区域&#x27;</span>, <span class="string">&#x27;销售渠道&#x27;</span>, <span class="string">&#x27;品牌&#x27;</span>, <span class="string">&#x27;销售额&#x27;</span>]</span><br><span class="line">)</span><br><span class="line">sales_df.info()</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>说明</strong>：如果需要上面例子中的 Excel 文件，可以通过下面的百度云盘地址进行获取，数据在《从零开始学数据分析》目录中。链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1rQujl5RQn9R7PadB2Z5g_g%EF%BC%8C%E6%8F%90%E5%8F%96%E7%A0%81%EF%BC%9Ae7b4%E3%80%82">https://pan.baidu.com/s/1rQujl5RQn9R7PadB2Z5g_g，提取码：e7b4。</a></p>
</blockquote>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span><br><span class="line">RangeIndex: 1945 entries, 0 to 1944</span><br><span class="line">Data columns (total 5 columns):</span><br><span class="line"> #   Column  Non-Null Count  Dtype         </span><br><span class="line">---  ------  --------------  -----         </span><br><span class="line"> 0   销售日期    1945 non-null   datetime64[ns]</span><br><span class="line"> 1   销售区域    1945 non-null   object        </span><br><span class="line"> 2   销售渠道    1945 non-null   object        </span><br><span class="line"> 3   品牌        1945 non-null   object        </span><br><span class="line"> 4   销售额      1945 non-null   int64         </span><br><span class="line">dtypes: datetime64[ns](1), int64(1), object(3)</span><br><span class="line">memory usage: 76.1+ KB</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sales_df[<span class="string">&#x27;月份&#x27;</span>] = sales_df[<span class="string">&#x27;销售日期&#x27;</span>].dt.month</span><br><span class="line">sales_df[<span class="string">&#x27;季度&#x27;</span>] = sales_df[<span class="string">&#x27;销售日期&#x27;</span>].dt.quarter</span><br><span class="line">sales_df[<span class="string">&#x27;星期&#x27;</span>] = sales_df[<span class="string">&#x27;销售日期&#x27;</span>].dt.weekday</span><br><span class="line">sales_df</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">	    销售日期	 销售区域	销售渠道	品牌	  销售额	月份	季度	星期</span><br><span class="line">0	    2020-01-01	上海	     拼多多	 八匹马   8217	    1	 1	   2</span><br><span class="line">1	    2020-01-01	上海	     抖音	      八匹马	6351	 1	  1	    2</span><br><span class="line">2	    2020-01-01	上海	     天猫	      八匹马	14365	 1	  1	    2</span><br><span class="line">3	    2020-01-01	上海	     天猫       八匹马	2366	 1	  1     2</span><br><span class="line">4	    2020-01-01	上海	     天猫 	  皮皮虾	15189	 1	  1     2</span><br><span class="line">...     ...         ...        ...       ...      ...     ...  ...   ...</span><br><span class="line">1940    2020-12-30	北京	     京东	      花花姑娘 6994     12	 4	   2</span><br><span class="line">1941    2020-12-30	福建	     实体	      八匹马	7663	 12	  4	    2</span><br><span class="line">1942    2020-12-31	福建	     实体	      花花姑娘 14795    12	 4	   3</span><br><span class="line">1943    2020-12-31	福建	     抖音	      八匹马	3481	 12	  4	    3</span><br><span class="line">1944    2020-12-31	福建	     天猫	      八匹马	2673	 12	  4	    3</span><br></pre></td></tr></table></figure>
<p>在上面的代码中，通过日期时间类型的<code>Series</code>对象的<code>dt</code> 属性，获得一个访问日期时间的对象，通过该对象的<code>year</code>、<code>month</code>、<code>quarter</code>、<code>hour</code>等属性，就可以获取到年、月、季度、小时等时间信息，获取到的仍然是一个<code>Series</code>对象，它包含了一组时间信息，所以我们通常也将这个<code>dt</code>属性称为“日期时间向量”。</p>
<p>我们再来说一说字符串类型的数据的处理，我们先从指定的 Excel 文件中读取某招聘网站的招聘数据。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">jobs_df = pd.read_csv(</span><br><span class="line">    <span class="string">&#x27;某招聘网站招聘数据.csv&#x27;</span>,</span><br><span class="line">    usecols=[<span class="string">&#x27;city&#x27;</span>, <span class="string">&#x27;companyFullName&#x27;</span>, <span class="string">&#x27;positionName&#x27;</span>, <span class="string">&#x27;salary&#x27;</span>]</span><br><span class="line">)</span><br><span class="line">jobs_df.info()</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>说明</strong>：如果需要上面例子中的 Excel 文件，可以通过下面的百度云盘地址进行获取，数据在《从零开始学数据分析》目录中。链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1rQujl5RQn9R7PadB2Z5g_g%EF%BC%8C%E6%8F%90%E5%8F%96%E7%A0%81%EF%BC%9Ae7b4%E3%80%82">https://pan.baidu.com/s/1rQujl5RQn9R7PadB2Z5g_g，提取码：e7b4。</a></p>
</blockquote>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span><br><span class="line">RangeIndex: 3140 entries, 0 to 3139</span><br><span class="line">Data columns (total 4 columns):</span><br><span class="line"> #   Column           Non-Null Count  Dtype </span><br><span class="line">---  ------           --------------  ----- </span><br><span class="line"> 0   city             3140 non-null   object</span><br><span class="line"> 1   companyFullName  3140 non-null   object</span><br><span class="line"> 2   positionName     3140 non-null   object</span><br><span class="line"> 3   salary           3140 non-null   object</span><br><span class="line">dtypes: object(4)</span><br><span class="line">memory usage: 98.2+ KB</span><br></pre></td></tr></table></figure>
<p>查看前<code>5</code>条数据。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">jobs_df.head()</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">    city    companyFullName              positionName    salary</span><br><span class="line">0   北京	  达疆网络科技（上海）有限公司    数据分析岗       15k-30k</span><br><span class="line">1   北京	  北京音娱时光科技有限公司        数据分析        10k-18k</span><br><span class="line">2   北京	  北京千喜鹤餐饮管理有限公司	     数据分析        20k-30k</span><br><span class="line">3   北京	  吉林省海生电子商务有限公司	     数据分析        33k-50k</span><br><span class="line">4   北京	  韦博网讯科技（北京）有限公司	数据分析        10k-15k</span><br></pre></td></tr></table></figure>
<p>上面的数据表一共有<code>3140</code>条数据，但并非所有的职位都是“数据分析”的岗位，如果要筛选出数据分析的岗位，可以通过检查<code>positionName</code>字段是否包含“数据分析”这个关键词，这里需要模糊匹配，应该如何实现呢？我们可以先获取<code>positionName</code>列，因为这个<code>Series</code>对象的<code>dtype</code>是字符串，所以可以通过<code>str</code>属性获取对应的字符串向量，然后就可以利用我们熟悉的字符串的方法来对其进行操作，代码如下所示。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">jobs_df = jobs_df[jobs_df.positionName.<span class="built_in">str</span>.contains(<span class="string">&#x27;数据分析&#x27;</span>)]</span><br><span class="line">jobs_df.shape</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(1515, 4)</span><br></pre></td></tr></table></figure>
<p>可以看出，筛选后的数据还有<code>1515</code>条。接下来，我们还需要对<code>salary</code>字段进行处理，如果我们希望统计所有岗位的平均工资或每个城市的平均工资，首先需要将用范围表示的工资处理成其中间值，代码如下所示。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">jobs_df.salary.<span class="built_in">str</span>.extract(<span class="string">r&#x27;(\d+)[kK]?-(\d+)[kK]?&#x27;</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>说明</strong>：上面的代码通过正则表达式捕获组从字符串中抽取出两组数字，分别对应工资的下限和上限，对正则表达式不熟悉的读者，可以阅读我的知乎专栏“从零开始学Python”中的<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/158929767">《正则表达式的应用》</a>一文。</p>
</blockquote>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">        0     1</span><br><span class="line">0	    15    30</span><br><span class="line">1	    10	  18</span><br><span class="line">2       20    30</span><br><span class="line">3       33    50</span><br><span class="line">4       10    15</span><br><span class="line">...     ...   ...</span><br><span class="line">3065    8     10</span><br><span class="line">3069    6     10</span><br><span class="line">3070    2     4</span><br><span class="line">3071    6     12</span><br><span class="line">3088    8     12</span><br></pre></td></tr></table></figure>
<p>需要提醒大家的是，抽取出来的两列数据都是字符串类型的值，我们需要将其转换成<code>int</code>类型，才能计算平均值，对应的方法是<code>DataFrame</code>对象的<code>applymap</code>方法，该方法的参数是一个函数，而该函数会作用于<code>DataFrame</code>中的每个元素。完成这一步之后，我们就可以使用<code>apply</code>方法将上面的<code>DataFrame</code>处理成中间值，<code>apply</code>方法的参数也是一个函数，可以通过指定<code>axis</code>参数使其作用于<code>DataFrame</code> 对象的行或列，代码如下所示。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">temp_df = jobs_df.salary.<span class="built_in">str</span>.extract(<span class="string">r&#x27;(\d+)[kK]?-(\d+)[kK]?&#x27;</span>).applymap(<span class="built_in">int</span>)</span><br><span class="line">temp_df.apply(np.mean, axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0       22.5</span><br><span class="line">1       14.0</span><br><span class="line">2       25.0</span><br><span class="line">3       41.5</span><br><span class="line">4       12.5</span><br><span class="line">        ... </span><br><span class="line">3065    9.0</span><br><span class="line">3069    8.0</span><br><span class="line">3070    3.0</span><br><span class="line">3071    9.0</span><br><span class="line">3088    10.0</span><br><span class="line">Length: 1515, dtype: float64</span><br></pre></td></tr></table></figure>
<p>接下来，我们可以用上面的结果替换掉原来的<code>salary</code>列或者增加一个新的列来表示职位对应的工资，完整的代码如下所示。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">temp_df = jobs_df.salary.<span class="built_in">str</span>.extract(<span class="string">r&#x27;(\d+)[kK]?-(\d+)[kK]?&#x27;</span>).applymap(<span class="built_in">int</span>)</span><br><span class="line">jobs_df[<span class="string">&#x27;salary&#x27;</span>] = temp_df.apply(np.mean, axis=<span class="number">1</span>)</span><br><span class="line">jobs_df.head()</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">    city    companyFullName              positionName    salary</span><br><span class="line">0   北京	  达疆网络科技（上海）有限公司    数据分析岗       22.5</span><br><span class="line">1   北京	  北京音娱时光科技有限公司        数据分析        14.0</span><br><span class="line">2   北京	  北京千喜鹤餐饮管理有限公司	     数据分析        25.0</span><br><span class="line">3   北京	  吉林省海生电子商务有限公司	     数据分析        41.5</span><br><span class="line">4   北京	  韦博网讯科技（北京）有限公司	数据分析        12.5</span><br></pre></td></tr></table></figure>
<p><code>applymap</code>和<code>apply</code>两个方法在数据预处理的时候经常用到，<code>Series</code>对象也有<code>apply</code>方法，也是用于数据的预处理，但是<code>DataFrame</code>对象还有一个名为<code>transform</code> 的方法，也是通过传入的函数对数据进行变换，类似<code>Series</code>对象的<code>map</code>方法。需要强调的是，<code>apply</code>方法具有归约效果的，简单的说就是能将较多的数据处理成较少的数据或一条数据；而<code>transform</code>方法没有归约效果，只能对数据进行变换，原来有多少条数据，处理后还是有多少条数据。</p>
<p>如果要对数据进行深度的分析和挖掘，字符串、日期时间这样的非数值类型都需要处理成数值，因为非数值类型没有办法计算相关性，也没有办法进行<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>χ</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\chi^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0085em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">χ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>检验等操作。对于字符串类型，通常可以其分为以下三类，再进行对应的处理。</p>
<ol>
<li>有序变量（Ordinal Variable）：字符串表示的数据有顺序关系，那么可以对字符串进行序号化处理。</li>
<li>分类变量（Categorical Variable）/ 名义变量（Nominal Variable）：字符串表示的数据没有大小关系和等级之分，那么就可以使用独热编码的方式处理成哑变量（虚拟变量）矩阵。</li>
<li>定距变量（Scale Variable）：字符串本质上对应到一个有大小高低之分的数据，而且可以进行加减运算，那么只需要将字符串处理成对应的数值即可。</li>
</ol>
<p>对于第1类和第3类，我们可以用上面提到的<code>apply</code>或<code>transform</code>方法来处理，也可以利用<code>scikit-learn</code>中的<code>OrdinalEncoder</code>处理第1类字符串，这个我们在后续的课程中会讲到。对于第2类字符串，可以使用<code>pandas</code>的<code>get_dummies()</code>函数来生成哑变量（虚拟变量）矩阵，代码如下所示。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">persons_df = pd.DataFrame(</span><br><span class="line">    data=&#123;</span><br><span class="line">        <span class="string">&#x27;姓名&#x27;</span>: [<span class="string">&#x27;关羽&#x27;</span>, <span class="string">&#x27;张飞&#x27;</span>, <span class="string">&#x27;赵云&#x27;</span>, <span class="string">&#x27;马超&#x27;</span>, <span class="string">&#x27;黄忠&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;职业&#x27;</span>: [<span class="string">&#x27;医生&#x27;</span>, <span class="string">&#x27;医生&#x27;</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="string">&#x27;画家&#x27;</span>, <span class="string">&#x27;教师&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;学历&#x27;</span>: [<span class="string">&#x27;研究生&#x27;</span>, <span class="string">&#x27;大专&#x27;</span>, <span class="string">&#x27;研究生&#x27;</span>, <span class="string">&#x27;高中&#x27;</span>, <span class="string">&#x27;本科&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line">persons_df</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">	姓名	职业	学历</span><br><span class="line">0	关羽	医生	研究生</span><br><span class="line">1	张飞	医生	大专</span><br><span class="line">2	赵云	程序员	研究生</span><br><span class="line">3	马超	画家	高中</span><br><span class="line">4	黄忠	教师	本科</span><br></pre></td></tr></table></figure>
<p>将职业处理成哑变量矩阵。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pd.get_dummies(persons_df[<span class="string">&#x27;职业&#x27;</span>])</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">    医生 教师  画家  程序员</span><br><span class="line">0	1    0    0    0</span><br><span class="line">1	1    0    0    0</span><br><span class="line">2	0    0    0    1</span><br><span class="line">3	0    0    1    0</span><br><span class="line">4	0    1    0    0</span><br></pre></td></tr></table></figure>
<p>将学历处理成大小不同的值。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">handle_education</span>(<span class="params">x</span>):</span><br><span class="line">    edu_dict = &#123;<span class="string">&#x27;高中&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;大专&#x27;</span>: <span class="number">3</span>, <span class="string">&#x27;本科&#x27;</span>: <span class="number">5</span>, <span class="string">&#x27;研究生&#x27;</span>: <span class="number">10</span>&#125;</span><br><span class="line">    <span class="keyword">return</span> edu_dict.get(x, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">persons_df[<span class="string">&#x27;学历&#x27;</span>].apply(handle_education)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0    10</span><br><span class="line">1     3</span><br><span class="line">2    10</span><br><span class="line">3     1</span><br><span class="line">4     5</span><br><span class="line">Name: 学历, dtype: int64</span><br></pre></td></tr></table></figure>
<p>我们再来说说数据离散化。离散化也叫分箱，如果变量的取值是连续值，那么它的取值有无数种可能，在进行数据分组的时候就会非常的不方便，这个时候将连续变量离散化就显得非常重要。之所以把离散化叫做分箱，是因为我们可以预先设置一些箱子，每个箱子代表了数据取值的范围，这样就可以将连续的值分配到不同的箱子中，从而实现离散化。下面的例子读取了2018年北京积分落户数据，我们可以根据落户积分对数据进行分组，具体的做法如下所示。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">luohu_df = pd.read_csv(<span class="string">&#x27;data/2018年北京积分落户数据.csv&#x27;</span>, index_col=<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">luohu_df.score.describe()</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">count    6019.000000</span><br><span class="line">mean       95.654552</span><br><span class="line">std         4.354445</span><br><span class="line">min        90.750000</span><br><span class="line">25%        92.330000</span><br><span class="line">50%        94.460000</span><br><span class="line">75%        97.750000</span><br><span class="line">max       122.590000</span><br><span class="line">Name: score, dtype: float64</span><br></pre></td></tr></table></figure>
<p>可以看出，落户积分的最大值是<code>122.59</code>，最小值是<code>90.75</code>，那么我们可以构造一个从<code>90</code>分到<code>125</code>分，每<code>5</code>分一组的<code>7</code>个箱子，<code>pandas</code>的<code>cut</code>函数可以帮助我们首先数据分箱，代码如下所示。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">bins = np.arange(<span class="number">90</span>, <span class="number">126</span>, <span class="number">5</span>)</span><br><span class="line">pd.cut(luohu_df.score, bins, right=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>说明</strong>：<code>cut</code>函数的<code>right</code>参数默认值为<code>True</code>，表示箱子左开右闭；修改为<code>False</code>可以让箱子的右边界为开区间，左边界为闭区间，大家看看下面的输出就明白了。</p>
</blockquote>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">id</span><br><span class="line">1       [120, 125)</span><br><span class="line">2       [120, 125)</span><br><span class="line">3       [115, 120)</span><br><span class="line">4       [115, 120)</span><br><span class="line">5       [115, 120)</span><br><span class="line">           ...    </span><br><span class="line">6015      [90, 95)</span><br><span class="line">6016      [90, 95)</span><br><span class="line">6017      [90, 95)</span><br><span class="line">6018      [90, 95)</span><br><span class="line">6019      [90, 95)</span><br><span class="line">Name: score, Length: 6019, dtype: category</span><br><span class="line">Categories (7, interval[int64, left]): [[90, 95) &lt; [95, 100) &lt; [100, 105) &lt; [105, 110) &lt; [110, 115) &lt; [115, 120) &lt; [120, 125)]</span><br></pre></td></tr></table></figure>
<p>我们可以根据分箱的结果对数据进行分组，然后使用聚合函数对每个组进行统计，这是数据分析中经常用到的操作，下一个章节会为大家介绍。除此之外，<code>pandas</code>还提供了一个名为<code>qcut</code>的函数，可以指定分位数对数据进行分箱，有兴趣的读者可以自行研究。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://yuanweize.github.io">GreenSeaa</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://yuanweize.github.io/2022/08/09/Python-100-Days/Day66-80/72.Pandas%E7%9A%84%E5%BA%94%E7%94%A8-3/">https://yuanweize.github.io/2022/08/09/Python-100-Days/Day66-80/72.Pandas的应用-3/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://yuanweize.github.io" target="_blank">HExLL-迷雾日志</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Python/">Python</a><a class="post-meta__tags" href="/tags/Day66-80/">Day66-80</a></div><div class="post_share"><div class="social-share" data-image="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/08/09/Python-100-Days/Day66-80/71.Pandas%E7%9A%84%E5%BA%94%E7%94%A8-2/"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">71.Pandas的应用-2</div></div></a></div><div class="next-post pull-right"><a href="/2022/08/09/Python-100-Days/Day66-80/73.Pandas%E7%9A%84%E5%BA%94%E7%94%A8-4/"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">73.Pandas的应用-4</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/08/09/Python-100-Days/Day66-80/66.%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E6%A6%82%E8%BF%B0/" title="66.数据分析概述"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 09-08-2022</div><div class="title">66.数据分析概述</div></div></a></div><div><a href="/2022/08/09/Python-100-Days/Day66-80/67.%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/" title="67.环境准备"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 09-08-2022</div><div class="title">67.环境准备</div></div></a></div><div><a href="/2022/08/09/Python-100-Days/Day66-80/68.NumPy%E7%9A%84%E5%BA%94%E7%94%A8-1/" title="68.NumPy的应用-1"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 09-08-2022</div><div class="title">68.NumPy的应用-1</div></div></a></div><div><a href="/2022/08/09/Python-100-Days/Day66-80/70.Pandas%E7%9A%84%E5%BA%94%E7%94%A8-1/" title="70.Pandas的应用-1"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 09-08-2022</div><div class="title">70.Pandas的应用-1</div></div></a></div><div><a href="/2022/08/09/Python-100-Days/Day66-80/69.NumPy%E7%9A%84%E5%BA%94%E7%94%A8-2/" title="69.NumPy的应用-2"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 09-08-2022</div><div class="title">69.NumPy的应用-2</div></div></a></div><div><a href="/2022/08/09/Python-100-Days/Day66-80/71.Pandas%E7%9A%84%E5%BA%94%E7%94%A8-2/" title="71.Pandas的应用-2"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 09-08-2022</div><div class="title">71.Pandas的应用-2</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s.gravatar.com/avatar/50de7ee8a1fc96ada7495a641400642d?s=512" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">GreenSeaa</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">803</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">75</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">72</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/yuanweize"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/yuanweize" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:info@eurun.eu.org" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://t.me/greenseaa" target="_blank" title=""><i class="fab fa-telegram"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Here is HExLL</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Pandas%E7%9A%84%E5%BA%94%E7%94%A8-3"><span class="toc-number">1.</span> <span class="toc-text">Pandas的应用-3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DataFrame%E7%9A%84%E5%BA%94%E7%94%A8-2"><span class="toc-number">1.1.</span> <span class="toc-text">DataFrame的应用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97"><span class="toc-number">1.1.1.</span> <span class="toc-text">数据清洗</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BC%BA%E5%A4%B1%E5%80%BC"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">缺失值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%87%8D%E5%A4%8D%E5%80%BC"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">重复值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%80%BC"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">异常值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%A2%84%E5%A4%84%E7%90%86"><span class="toc-number">1.1.1.4.</span> <span class="toc-text">预处理</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/10/31/6-%E7%94%A8%20Vue3%20%E5%92%8C%20Django%20%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE/" title="6-用 Vue3 和 Django 快速搭建前后端分离项目">6-用 Vue3 和 Django 快速搭建前后端分离项目</a><time datetime="2022-10-31T00:59:54.000Z" title="发表于 31-10-2022 01:59:54">31-10-2022</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/10/30/3-%E6%94%BE%E5%BC%83%E7%BA%A0%E7%BB%93%E3%80%81%E6%8B%A5%E6%8A%B1%E5%A6%A5%E5%8D%8F%EF%BC%8C%E9%87%8D%E5%99%A8%E8%BD%BB%E7%94%A8%E5%B0%B1%E6%98%AF%E9%AB%98%E6%95%88@annote/" title="3-放弃纠结、拥抱妥协，重器轻用就是高效@annote">3-放弃纠结、拥抱妥协，重器轻用就是高效@annote</a><time datetime="2022-10-30T04:30:45.000Z" title="发表于 30-10-2022 05:30:45">30-10-2022</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/08/15/C%E8%AF%AD%E8%A8%80%E4%B8%8EC-%E5%AD%A6%E4%B9%A0/" title="C语言与C++学习">C语言与C++学习</a><time datetime="2022-08-14T22:39:16.000Z" title="发表于 15-08-2022 00:39:16">15-08-2022</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/08/14/Linux-command/type/" title="type">type</a><time datetime="2022-08-14T20:29:33.000Z" title="发表于 14-08-2022 22:29:33">14-08-2022</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/08/14/Linux-command/ulimit/" title="ulimit">ulimit</a><time datetime="2022-08-14T20:29:33.000Z" title="发表于 14-08-2022 22:29:33">14-08-2022</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By GreenSeaa</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/algoliasearch-lite.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>