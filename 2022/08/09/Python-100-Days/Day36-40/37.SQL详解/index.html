<!DOCTYPE html><html class="hide-aside" lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>37.SQL详解 | HExLL</title><meta name="keywords" content="Python,Day36-40"><meta name="author" content="GreenSeaa"><meta name="copyright" content="GreenSeaa"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="SQL 和 MySQL 详解 SQL 详解 我们通常可以将 SQL 分为四类，分别是 DDL（数据定义语言）、DML（数据操作语言）、DQL（数据查询语言）和 DCL（数据控制语言）。DDL 主要用于创建、删除、修改数据库中的对象，比如创建、删除和修改二维表，核心的关键字包括create、drop和alter；DML 主要负责数据的插入、删除和更新，关键词包括insert、delete和updat">
<meta property="og:type" content="article">
<meta property="og:title" content="37.SQL详解">
<meta property="og:url" content="https://yuanweize.github.io/2022/08/09/Python-100-Days/Day36-40/37.SQL%E8%AF%A6%E8%A7%A3/index.html">
<meta property="og:site_name" content="HExLL">
<meta property="og:description" content="SQL 和 MySQL 详解 SQL 详解 我们通常可以将 SQL 分为四类，分别是 DDL（数据定义语言）、DML（数据操作语言）、DQL（数据查询语言）和 DCL（数据控制语言）。DDL 主要用于创建、删除、修改数据库中的对象，比如创建、删除和修改二维表，核心的关键字包括create、drop和alter；DML 主要负责数据的插入、删除和更新，关键词包括insert、delete和updat">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
<meta property="article:published_time" content="2022-08-09T05:39:47.000Z">
<meta property="article:modified_time" content="2022-08-09T15:08:26.733Z">
<meta property="article:author" content="GreenSeaa">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="Day36-40">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://yuanweize.github.io/2022/08/09/Python-100-Days/Day36-40/37.SQL%E8%AF%A6%E8%A7%A3/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"SW7OVVVFHX","apiKey":"5d05023a8579462e72ea704e4f43cf3f","indexName":"hexo","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '37.SQL详解',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '09-08-2022 17:08:26'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.2.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s.gravatar.com/avatar/50de7ee8a1fc96ada7495a641400642d?s=512" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">154</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">55</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">56</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Day01-15/"><i class="fa-fw fas fa-music"></i><span> Python</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">HExLL</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Day01-15/"><i class="fa-fw fas fa-music"></i><span> Python</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">37.SQL详解</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-08-09T05:39:47.000Z" title="发表于 09-08-2022 07:39:47">09-08-2022</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-08-09T15:08:26.733Z" title="更新于 09-08-2022 17:08:26">09-08-2022</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Python-100-Days/">Python-100-Days</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Python-100-Days/Day36-40/">Day36-40</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">14.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>55分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="37.SQL详解"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="SQL-和-MySQL-详解">SQL 和 MySQL 详解</h2>
<h3 id="SQL-详解">SQL 详解</h3>
<p>我们通常可以将 SQL 分为四类，分别是 DDL（数据定义语言）、DML（数据操作语言）、DQL（数据查询语言）和 DCL（数据控制语言）。DDL 主要用于创建、删除、修改数据库中的对象，比如创建、删除和修改二维表，核心的关键字包括<code>create</code>、<code>drop</code>和<code>alter</code>；DML 主要负责数据的插入、删除和更新，关键词包括<code>insert</code>、<code>delete</code>和<code>update</code>；DQL 负责数据查询，最重要的一个关键词是<code>select</code>；DCL 通常用于授予和召回权限，核心关键词是<code>grant</code>和<code>revoke</code>。</p>
<blockquote>
<p><strong>说明</strong>：SQL 是不区分大小写的语言，为了书写和识别方便，下面的 SQL 都使用了小写字母来书写。</p>
</blockquote>
<h4 id="DDL（数据定义语言）">DDL（数据定义语言）</h4>
<p>下面我们来实现一个选课系统的数据库，如下所示的 SQL 创建了名为<code>school</code>的数据库和五张表，分别是学院表（<code>tb_college</code>）、学生表（<code>tb_student</code>）、教师表（<code>tb_teacher</code>）、课程表（<code>tb_course</code>）和选课记录表（<code>tb_record</code>），其中学生和教师跟学院之间是多对一关系，课程跟老师之间也是多对一关系，学生和课程是多对多关系，选课记录表就是维持学生跟课程多对多关系的中间表。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 如果存在名为school的数据库就删除它</span></span><br><span class="line"><span class="keyword">drop</span> database if <span class="keyword">exists</span> `school`;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建名为school的数据库并设置默认的字符集和排序方式</span></span><br><span class="line"><span class="keyword">create</span> database `school` <span class="keyword">default</span> <span class="type">character</span> <span class="keyword">set</span> utf8mb4 <span class="keyword">collate</span> utf8mb4_general_ci;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 切换到school数据库上下文环境</span></span><br><span class="line">use `school`;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建学院表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> `tb_college`</span><br><span class="line">(</span><br><span class="line">`col_id` <span class="type">int</span> unsigned auto_increment comment <span class="string">&#x27;编号&#x27;</span>,</span><br><span class="line">`col_name` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;名称&#x27;</span>,</span><br><span class="line">`col_intro` <span class="type">varchar</span>(<span class="number">500</span>) <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span> comment <span class="string">&#x27;介绍&#x27;</span>,</span><br><span class="line"><span class="keyword">primary</span> key (`col_id`)</span><br><span class="line">) engine<span class="operator">=</span>innodb auto_increment<span class="operator">=</span><span class="number">1</span> comment <span class="string">&#x27;学院表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建学生表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> `tb_student`</span><br><span class="line">(</span><br><span class="line">`stu_id` <span class="type">int</span> unsigned <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;学号&#x27;</span>,</span><br><span class="line">`stu_name` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">`stu_sex` <span class="type">boolean</span> <span class="keyword">default</span> <span class="number">1</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;性别&#x27;</span>,</span><br><span class="line">`stu_birth` <span class="type">date</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;出生日期&#x27;</span>,</span><br><span class="line">`stu_addr` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span> comment <span class="string">&#x27;籍贯&#x27;</span>,</span><br><span class="line">`col_id` <span class="type">int</span> unsigned <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;所属学院&#x27;</span>,</span><br><span class="line"><span class="keyword">primary</span> key (`stu_id`),</span><br><span class="line"><span class="keyword">constraint</span> `fk_student_col_id` <span class="keyword">foreign</span> key (`col_id`) <span class="keyword">references</span> `tb_college` (`col_id`)</span><br><span class="line">) engine<span class="operator">=</span>innodb comment <span class="string">&#x27;学生表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建教师表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> `tb_teacher`</span><br><span class="line">(</span><br><span class="line">`tea_id` <span class="type">int</span> unsigned <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;工号&#x27;</span>,</span><br><span class="line">`tea_name` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">`tea_title` <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">default</span> <span class="string">&#x27;助教&#x27;</span> comment <span class="string">&#x27;职称&#x27;</span>,</span><br><span class="line">`col_id` <span class="type">int</span> unsigned <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;所属学院&#x27;</span>,</span><br><span class="line"><span class="keyword">primary</span> key (`tea_id`),</span><br><span class="line"><span class="keyword">constraint</span> `fk_teacher_col_id` <span class="keyword">foreign</span> key (`col_id`) <span class="keyword">references</span> `tb_college` (`col_id`)</span><br><span class="line">) engine<span class="operator">=</span>innodb comment <span class="string">&#x27;老师表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建课程表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> `tb_course`</span><br><span class="line">(</span><br><span class="line">`cou_id` <span class="type">int</span> unsigned <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;编号&#x27;</span>,</span><br><span class="line">`cou_name` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;名称&#x27;</span>,</span><br><span class="line">`cou_credit` <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;学分&#x27;</span>,</span><br><span class="line">`tea_id` <span class="type">int</span> unsigned <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;授课老师&#x27;</span>,</span><br><span class="line"><span class="keyword">primary</span> key (`cou_id`),</span><br><span class="line"><span class="keyword">constraint</span> `fk_course_tea_id` <span class="keyword">foreign</span> key (`tea_id`) <span class="keyword">references</span> `tb_teacher` (`tea_id`)</span><br><span class="line">) engine<span class="operator">=</span>innodb comment <span class="string">&#x27;课程表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建选课记录表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> `tb_record`</span><br><span class="line">(</span><br><span class="line">`rec_id` <span class="type">bigint</span> unsigned auto_increment comment <span class="string">&#x27;选课记录号&#x27;</span>,</span><br><span class="line">`stu_id` <span class="type">int</span> unsigned <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;学号&#x27;</span>,</span><br><span class="line">`cou_id` <span class="type">int</span> unsigned <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;课程编号&#x27;</span>,</span><br><span class="line">`sel_date` <span class="type">date</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;选课日期&#x27;</span>,</span><br><span class="line">`score` <span class="type">decimal</span>(<span class="number">4</span>,<span class="number">1</span>) comment <span class="string">&#x27;考试成绩&#x27;</span>,</span><br><span class="line"><span class="keyword">primary</span> key (`rec_id`),</span><br><span class="line"><span class="keyword">constraint</span> `fk_record_stu_id` <span class="keyword">foreign</span> key (`stu_id`) <span class="keyword">references</span> `tb_student` (`stu_id`),</span><br><span class="line"><span class="keyword">constraint</span> `fk_record_cou_id` <span class="keyword">foreign</span> key (`cou_id`) <span class="keyword">references</span> `tb_course` (`cou_id`),</span><br><span class="line"><span class="keyword">constraint</span> `uk_record_stu_cou` <span class="keyword">unique</span> (`stu_id`, `cou_id`)</span><br><span class="line">) engine<span class="operator">=</span>innodb comment <span class="string">&#x27;选课记录表&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>上面的DDL有几个地方需要强调一下：</p>
<ul>
<li>
<p>创建数据库时，我们通过<code>default character set utf8mb4</code>指定了数据库默认使用的字符集为<code>utf8mb4</code>（最大<code>4</code>字节的<code>utf-8</code>编码），我们推荐使用该字符集，它也是 MySQL 8.x 默认使用的字符集，因为它能够支持国际化编码，还可以存储 Emoji 字符。可以通过下面的命令查看 MySQL 支持的字符集以及默认的排序规则。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="type">character</span> <span class="keyword">set</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">+----------+---------------------------------+---------------------+--------+</span><br><span class="line">| Charset  | Description                     | Default collation   | Maxlen |</span><br><span class="line">+----------+---------------------------------+---------------------+--------+</span><br><span class="line">| big5     | Big5 Traditional Chinese        | big5_chinese_ci     |      2 |</span><br><span class="line">| dec8     | DEC West European               | dec8_swedish_ci     |      1 |</span><br><span class="line">| cp850    | DOS West European               | cp850_general_ci    |      1 |</span><br><span class="line">| hp8      | HP West European                | hp8_english_ci      |      1 |</span><br><span class="line">| koi8r    | KOI8-R Relcom Russian           | koi8r_general_ci    |      1 |</span><br><span class="line">| latin1   | cp1252 West European            | latin1_swedish_ci   |      1 |</span><br><span class="line">| latin2   | ISO 8859-2 Central European     | latin2_general_ci   |      1 |</span><br><span class="line">| swe7     | 7bit Swedish                    | swe7_swedish_ci     |      1 |</span><br><span class="line">| ascii    | US ASCII                        | ascii_general_ci    |      1 |</span><br><span class="line">| ujis     | EUC-JP Japanese                 | ujis_japanese_ci    |      3 |</span><br><span class="line">| sjis     | Shift-JIS Japanese              | sjis_japanese_ci    |      2 |</span><br><span class="line">| hebrew   | ISO 8859-8 Hebrew               | hebrew_general_ci   |      1 |</span><br><span class="line">| tis620   | TIS620 Thai                     | tis620_thai_ci      |      1 |</span><br><span class="line">| euckr    | EUC-KR Korean                   | euckr_korean_ci     |      2 |</span><br><span class="line">| koi8u    | KOI8-U Ukrainian                | koi8u_general_ci    |      1 |</span><br><span class="line">| gb2312   | GB2312 Simplified Chinese       | gb2312_chinese_ci   |      2 |</span><br><span class="line">| greek    | ISO 8859-7 Greek                | greek_general_ci    |      1 |</span><br><span class="line">| cp1250   | Windows Central European        | cp1250_general_ci   |      1 |</span><br><span class="line">| gbk      | GBK Simplified Chinese          | gbk_chinese_ci      |      2 |</span><br><span class="line">| latin5   | ISO 8859-9 Turkish              | latin5_turkish_ci   |      1 |</span><br><span class="line">| armscii8 | ARMSCII-8 Armenian              | armscii8_general_ci |      1 |</span><br><span class="line">| utf8     | UTF-8 Unicode                   | utf8_general_ci     |      3 |</span><br><span class="line">| ucs2     | UCS-2 Unicode                   | ucs2_general_ci     |      2 |</span><br><span class="line">| cp866    | DOS Russian                     | cp866_general_ci    |      1 |</span><br><span class="line">| keybcs2  | DOS Kamenicky Czech-Slovak      | keybcs2_general_ci  |      1 |</span><br><span class="line">| macce    | Mac Central European            | macce_general_ci    |      1 |</span><br><span class="line">| macroman | Mac West European               | macroman_general_ci |      1 |</span><br><span class="line">| cp852    | DOS Central European            | cp852_general_ci    |      1 |</span><br><span class="line">| latin7   | ISO 8859-13 Baltic              | latin7_general_ci   |      1 |</span><br><span class="line">| utf8mb4  | UTF-8 Unicode                   | utf8mb4_general_ci  |      4 |</span><br><span class="line">| cp1251   | Windows Cyrillic                | cp1251_general_ci   |      1 |</span><br><span class="line">| utf16    | UTF-16 Unicode                  | utf16_general_ci    |      4 |</span><br><span class="line">| utf16le  | UTF-16LE Unicode                | utf16le_general_ci  |      4 |</span><br><span class="line">| cp1256   | Windows Arabic                  | cp1256_general_ci   |      1 |</span><br><span class="line">| cp1257   | Windows Baltic                  | cp1257_general_ci   |      1 |</span><br><span class="line">| utf32    | UTF-32 Unicode                  | utf32_general_ci    |      4 |</span><br><span class="line">| binary   | Binary pseudo charset           | binary              |      1 |</span><br><span class="line">| geostd8  | GEOSTD8 Georgian                | geostd8_general_ci  |      1 |</span><br><span class="line">| cp932    | SJIS for Windows Japanese       | cp932_japanese_ci   |      2 |</span><br><span class="line">| eucjpms  | UJIS for Windows Japanese       | eucjpms_japanese_ci |      3 |</span><br><span class="line">| gb18030  | China National Standard GB18030 | gb18030_chinese_ci  |      4 |</span><br><span class="line">+----------+---------------------------------+---------------------+--------+</span><br><span class="line">41 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>如果要设置 MySQL 服务启动时默认使用的字符集，可以修改MySQL的配置并添加以下内容。</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">character-set-server</span>=utf8</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在创建表的时候，可以自行选择底层的存储引擎。MySQL 支持多种存储引擎，可以通过<code>show engines</code>命令进行查看。MySQL 5.5 以后的版本默认使用的存储引擎是 InnoDB，它是我们推荐大家使用的存储引擎（因为更适合当下互联网应用对高并发、性能以及事务支持等方面的需求），为了 SQL 语句的向下兼容性，我们可以在建表语句结束处右圆括号的后面通过<code>engine=innodb</code>来指定使用 InnoDB 存储引擎。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> engines\G</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">*************************** 1. row ***************************</span><br><span class="line">      Engine: InnoDB</span><br><span class="line">     Support: DEFAULT</span><br><span class="line">     Comment: Supports transactions, row-level locking, and foreign keys</span><br><span class="line">Transactions: YES</span><br><span class="line">          XA: YES</span><br><span class="line">  Savepoints: YES</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">      Engine: MRG_MYISAM</span><br><span class="line">     Support: YES</span><br><span class="line">     Comment: Collection of identical MyISAM tables</span><br><span class="line">Transactions: NO</span><br><span class="line">          XA: NO</span><br><span class="line">  Savepoints: NO</span><br><span class="line">*************************** 3. row ***************************</span><br><span class="line">      Engine: MEMORY</span><br><span class="line">     Support: YES</span><br><span class="line">     Comment: Hash based, stored in memory, useful for temporary tables</span><br><span class="line">Transactions: NO</span><br><span class="line">          XA: NO</span><br><span class="line">  Savepoints: NO</span><br><span class="line">*************************** 4. row ***************************</span><br><span class="line">      Engine: BLACKHOLE</span><br><span class="line">     Support: YES</span><br><span class="line">     Comment: /dev/null storage engine (anything you write to it disappears)</span><br><span class="line">Transactions: NO</span><br><span class="line">          XA: NO</span><br><span class="line">  Savepoints: NO</span><br><span class="line">*************************** 5. row ***************************</span><br><span class="line">      Engine: MyISAM</span><br><span class="line">     Support: YES</span><br><span class="line">     Comment: MyISAM storage engine</span><br><span class="line">Transactions: NO</span><br><span class="line">          XA: NO</span><br><span class="line">  Savepoints: NO</span><br><span class="line">*************************** 6. row ***************************</span><br><span class="line">      Engine: CSV</span><br><span class="line">     Support: YES</span><br><span class="line">     Comment: CSV storage engine</span><br><span class="line">Transactions: NO</span><br><span class="line">          XA: NO</span><br><span class="line">  Savepoints: NO</span><br><span class="line">*************************** 7. row ***************************</span><br><span class="line">      Engine: ARCHIVE</span><br><span class="line">     Support: YES</span><br><span class="line">     Comment: Archive storage engine</span><br><span class="line">Transactions: NO</span><br><span class="line">          XA: NO</span><br><span class="line">  Savepoints: NO</span><br><span class="line">*************************** 8. row ***************************</span><br><span class="line">      Engine: PERFORMANCE_SCHEMA</span><br><span class="line">     Support: YES</span><br><span class="line">     Comment: Performance Schema</span><br><span class="line">Transactions: NO</span><br><span class="line">          XA: NO</span><br><span class="line">  Savepoints: NO</span><br><span class="line">*************************** 9. row ***************************</span><br><span class="line">      Engine: FEDERATED</span><br><span class="line">     Support: NO</span><br><span class="line">     Comment: Federated MySQL storage engine</span><br><span class="line">Transactions: NULL</span><br><span class="line">          XA: NULL</span><br><span class="line">  Savepoints: NULL</span><br><span class="line">9 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>下面的表格对MySQL几种常用的数据引擎进行了简单的对比。</p>
<table>
<thead>
<tr>
<th>特性</th>
<th>InnoDB</th>
<th>MRG_MYISAM</th>
<th>MEMORY</th>
<th>MyISAM</th>
</tr>
</thead>
<tbody>
<tr>
<td>存储限制</td>
<td>有</td>
<td>没有</td>
<td>有</td>
<td>有</td>
</tr>
<tr>
<td>事务</td>
<td>支持</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>锁机制</td>
<td>行锁</td>
<td>表锁</td>
<td>表锁</td>
<td>表锁</td>
</tr>
<tr>
<td>B树索引</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td>哈希索引</td>
<td></td>
<td></td>
<td>支持</td>
<td></td>
</tr>
<tr>
<td>全文检索</td>
<td>支持（5.6+）</td>
<td></td>
<td></td>
<td>支持</td>
</tr>
<tr>
<td>集群索引</td>
<td>支持</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>数据缓存</td>
<td>支持</td>
<td></td>
<td>支持</td>
<td></td>
</tr>
<tr>
<td>索引缓存</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td>数据可压缩</td>
<td></td>
<td></td>
<td></td>
<td>支持</td>
</tr>
<tr>
<td>内存使用</td>
<td>高</td>
<td>低</td>
<td>中</td>
<td>低</td>
</tr>
<tr>
<td>存储空间使用</td>
<td>高</td>
<td>低</td>
<td></td>
<td>低</td>
</tr>
<tr>
<td>批量插入性能</td>
<td>低</td>
<td>高</td>
<td>高</td>
<td>高</td>
</tr>
<tr>
<td>是否支持外键</td>
<td>支持</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>通过上面的比较我们可以了解到，InnoDB 是唯一能够支持外键、事务以及行锁的存储引擎，所以我们之前说它更适合互联网应用，而且在较新版本的 MySQL 中，它也是默认使用的存储引擎。</p>
</li>
<li>
<p>在定义表结构为每个字段选择数据类型时，如果不清楚哪个数据类型更合适，可以通过 MySQL 的帮助系统来了解每种数据类型的特性、数据的长度和精度等相关信息。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">? data types</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">You asked for help about help category: &quot;Data Types&quot;</span><br><span class="line">For more information, type &#x27;help &lt;item&gt;&#x27;, where &lt;item&gt; is one of the following</span><br><span class="line">topics:</span><br><span class="line">   AUTO_INCREMENT</span><br><span class="line">   BIGINT</span><br><span class="line">   BINARY</span><br><span class="line">   BIT</span><br><span class="line">   BLOB</span><br><span class="line">   BLOB DATA TYPE</span><br><span class="line">   BOOLEAN</span><br><span class="line">   CHAR</span><br><span class="line">   CHAR BYTE</span><br><span class="line">   DATE</span><br><span class="line">   DATETIME</span><br><span class="line">   DEC</span><br><span class="line">   DECIMAL</span><br><span class="line">   DOUBLE</span><br><span class="line">   DOUBLE PRECISION</span><br><span class="line">   ENUM</span><br><span class="line">   FLOAT</span><br><span class="line">   INT</span><br><span class="line">   INTEGER</span><br><span class="line">   LONGBLOB</span><br><span class="line">   LONGTEXT</span><br><span class="line">   MEDIUMBLOB</span><br><span class="line">   MEDIUMINT</span><br><span class="line">   MEDIUMTEXT</span><br><span class="line">   SET DATA TYPE</span><br><span class="line">   SMALLINT</span><br><span class="line">   TEXT</span><br><span class="line">   TIME</span><br><span class="line">   TIMESTAMP</span><br><span class="line">   TINYBLOB</span><br><span class="line">   TINYINT</span><br><span class="line">   TINYTEXT</span><br><span class="line">   VARBINARY</span><br><span class="line">   VARCHAR</span><br><span class="line">   YEAR DATA TYPE</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">? <span class="type">varchar</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Name: &#x27;VARCHAR&#x27;</span><br><span class="line">Description:</span><br><span class="line">[NATIONAL] VARCHAR(M) [CHARACTER SET charset_name] [COLLATE</span><br><span class="line">collation_name]</span><br><span class="line"></span><br><span class="line">A variable-length string. M represents the maximum column length in</span><br><span class="line">characters. The range of M is 0 to 65,535. The effective maximum length</span><br><span class="line">of a VARCHAR is subject to the maximum row size (65,535 bytes, which is</span><br><span class="line">shared among all columns) and the character set used. For example, utf8</span><br><span class="line">characters can require up to three bytes per character, so a VARCHAR</span><br><span class="line">column that uses the utf8 character set can be declared to be a maximum</span><br><span class="line">of 21,844 characters. See</span><br><span class="line">http://dev.mysql.com/doc/refman/5.7/en/column-count-limit.html.</span><br><span class="line"></span><br><span class="line">MySQL stores VARCHAR values as a 1-byte or 2-byte length prefix plus</span><br><span class="line">data. The length prefix indicates the number of bytes in the value. A</span><br><span class="line">VARCHAR column uses one length byte if values require no more than 255</span><br><span class="line">bytes, two length bytes if values may require more than 255 bytes.</span><br><span class="line"></span><br><span class="line">*Note*:</span><br><span class="line"></span><br><span class="line">MySQL follows the standard SQL specification, and does not remove</span><br><span class="line">trailing spaces from VARCHAR values.</span><br><span class="line"></span><br><span class="line">VARCHAR is shorthand for CHARACTER VARYING. NATIONAL VARCHAR is the</span><br><span class="line">standard SQL way to define that a VARCHAR column should use some</span><br><span class="line">predefined character set. MySQL uses utf8 as this predefined character</span><br><span class="line">set. http://dev.mysql.com/doc/refman/5.7/en/charset-national.html.</span><br><span class="line">NVARCHAR is shorthand for NATIONAL VARCHAR.</span><br><span class="line"></span><br><span class="line">URL: http://dev.mysql.com/doc/refman/5.7/en/string-type-overview.html</span><br></pre></td></tr></table></figure>
<p>在数据类型的选择上，保存字符串数据通常都使用<code>VARCHAR</code>和<code>CHAR</code>两种类型，前者通常称为变长字符串，而后者通常称为定长字符串；对于 InnoDB 存储引擎，行存储格式没有区分固定长度和可变长度列，因此<code>VARCHAR</code>类型和<code>CHAR</code>类型没有本质区别，后者不一定比前者性能更好。如果要保存的很大字符串，可以使用<code>TEXT</code>类型；如果要保存很大的字节串，可以使用<code>BLOB</code>（二进制大对象）类型。在 MySQL 中，<code>TEXT</code>和<code>BLOB</code>又分别包括<code>TEXT</code>、<code>MEDIUMTEXT</code>、<code>LONGTEXT</code>和<code>BLOB</code>、<code>MEDIUMBLOB</code>、<code>LONGBLOB</code>三种不同的类型，它们主要的区别在于存储数据的最大大小不同。保存浮点数可以用<code>FLOAT</code>或<code>DOUBLE</code>类型，<code>FLOAT</code>已经不推荐使用了，而且在 MySQL 后续的版本中可能会被移除掉。而保存定点数应该使用<code>DECIMAL</code>类型。如果要保存时间日期，<code>DATETIME</code>类型优于<code>TIMESTAMP</code>类型，因为前者能表示的时间日期范围更大。</p>
</li>
</ul>
<h4 id="DML（数据操作语言）">DML（数据操作语言）</h4>
<p>我们通过如下所示的 SQL 给上面创建的表添加数据。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">use school;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入学院数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `tb_college` </span><br><span class="line">    (`col_name`, `col_intro`) </span><br><span class="line"><span class="keyword">values</span> </span><br><span class="line">    (<span class="string">&#x27;计算机学院&#x27;</span>, <span class="string">&#x27;计算机学院1958年设立计算机专业，1981年建立计算机科学系，1998年设立计算机学院，2005年5月，为了进一步整合教学和科研资源，学校决定，计算机学院和软件学院行政班子合并统一运作、实行教学和学生管理独立运行的模式。 学院下设三个系：计算机科学与技术系、物联网工程系、计算金融系；两个研究所：图象图形研究所、网络空间安全研究院（2015年成立）；三个教学实验中心：计算机基础教学实验中心、IBM技术中心和计算机专业实验中心。&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;外国语学院&#x27;</span>, <span class="string">&#x27;外国语学院设有7个教学单位，6个文理兼收的本科专业；拥有1个一级学科博士授予点，3个二级学科博士授予点，5个一级学科硕士学位授权点，5个二级学科硕士学位授权点，5个硕士专业授权领域，同时还有2个硕士专业学位（MTI）专业；有教职员工210余人，其中教授、副教授80余人，教师中获得中国国内外名校博士学位和正在职攻读博士学位的教师比例占专任教师的60%以上。&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;经济管理学院&#x27;</span>, <span class="string">&#x27;经济学院前身是创办于1905年的经济科；已故经济学家彭迪先、张与九、蒋学模、胡寄窗、陶大镛、胡代光，以及当代学者刘诗白等曾先后在此任教或学习。&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入学生数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `tb_student` </span><br><span class="line">    (`stu_id`, `stu_name`, `stu_sex`, `stu_birth`, `stu_addr`, `col_id`) </span><br><span class="line"><span class="keyword">values</span></span><br><span class="line">    (<span class="number">1001</span>, <span class="string">&#x27;杨过&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;1990-3-4&#x27;</span>, <span class="string">&#x27;湖南长沙&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">    (<span class="number">1002</span>, <span class="string">&#x27;任我行&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;1992-2-2&#x27;</span>, <span class="string">&#x27;湖南长沙&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">    (<span class="number">1033</span>, <span class="string">&#x27;王语嫣&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;1989-12-3&#x27;</span>, <span class="string">&#x27;四川成都&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">    (<span class="number">1572</span>, <span class="string">&#x27;岳不群&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;1993-7-19&#x27;</span>, <span class="string">&#x27;陕西咸阳&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">    (<span class="number">1378</span>, <span class="string">&#x27;纪嫣然&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;1995-8-12&#x27;</span>, <span class="string">&#x27;四川绵阳&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">    (<span class="number">1954</span>, <span class="string">&#x27;林平之&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;1994-9-20&#x27;</span>, <span class="string">&#x27;福建莆田&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">    (<span class="number">2035</span>, <span class="string">&#x27;东方不败&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;1988-6-30&#x27;</span>, <span class="keyword">null</span>, <span class="number">2</span>),</span><br><span class="line">    (<span class="number">3011</span>, <span class="string">&#x27;林震南&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;1985-12-12&#x27;</span>, <span class="string">&#x27;福建莆田&#x27;</span>, <span class="number">3</span>),</span><br><span class="line">    (<span class="number">3755</span>, <span class="string">&#x27;项少龙&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;1993-1-25&#x27;</span>, <span class="string">&#x27;四川成都&#x27;</span>, <span class="number">3</span>),</span><br><span class="line">    (<span class="number">3923</span>, <span class="string">&#x27;杨不悔&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;1985-4-17&#x27;</span>, <span class="string">&#x27;四川成都&#x27;</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入老师数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `tb_teacher` </span><br><span class="line">    (`tea_id`, `tea_name`, `tea_title`, `col_id`) </span><br><span class="line"><span class="keyword">values</span> </span><br><span class="line">    (<span class="number">1122</span>, <span class="string">&#x27;张三丰&#x27;</span>, <span class="string">&#x27;教授&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">    (<span class="number">1133</span>, <span class="string">&#x27;宋远桥&#x27;</span>, <span class="string">&#x27;副教授&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">    (<span class="number">1144</span>, <span class="string">&#x27;杨逍&#x27;</span>, <span class="string">&#x27;副教授&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">    (<span class="number">2255</span>, <span class="string">&#x27;范遥&#x27;</span>, <span class="string">&#x27;副教授&#x27;</span>, <span class="number">2</span>),</span><br><span class="line">    (<span class="number">3366</span>, <span class="string">&#x27;韦一笑&#x27;</span>, <span class="keyword">default</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入课程数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `tb_course` </span><br><span class="line">    (`cou_id`, `cou_name`, `cou_credit`, `tea_id`) </span><br><span class="line"><span class="keyword">values</span> </span><br><span class="line">    (<span class="number">1111</span>, <span class="string">&#x27;Python程序设计&#x27;</span>, <span class="number">3</span>, <span class="number">1122</span>),</span><br><span class="line">    (<span class="number">2222</span>, <span class="string">&#x27;Web前端开发&#x27;</span>, <span class="number">2</span>, <span class="number">1122</span>),</span><br><span class="line">    (<span class="number">3333</span>, <span class="string">&#x27;操作系统&#x27;</span>, <span class="number">4</span>, <span class="number">1122</span>),</span><br><span class="line">    (<span class="number">4444</span>, <span class="string">&#x27;计算机网络&#x27;</span>, <span class="number">2</span>, <span class="number">1133</span>),</span><br><span class="line">    (<span class="number">5555</span>, <span class="string">&#x27;编译原理&#x27;</span>, <span class="number">4</span>, <span class="number">1144</span>),</span><br><span class="line">    (<span class="number">6666</span>, <span class="string">&#x27;算法和数据结构&#x27;</span>, <span class="number">3</span>, <span class="number">1144</span>),</span><br><span class="line">    (<span class="number">7777</span>, <span class="string">&#x27;经贸法语&#x27;</span>, <span class="number">3</span>, <span class="number">2255</span>),</span><br><span class="line">    (<span class="number">8888</span>, <span class="string">&#x27;成本会计&#x27;</span>, <span class="number">2</span>, <span class="number">3366</span>),</span><br><span class="line">    (<span class="number">9999</span>, <span class="string">&#x27;审计学&#x27;</span>, <span class="number">3</span>, <span class="number">3366</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入选课数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `tb_record` </span><br><span class="line">    (`stu_id`, `cou_id`, `sel_date`, `score`) </span><br><span class="line"><span class="keyword">values</span> </span><br><span class="line">    (<span class="number">1001</span>, <span class="number">1111</span>, <span class="string">&#x27;2017-09-01&#x27;</span>, <span class="number">95</span>),</span><br><span class="line">    (<span class="number">1001</span>, <span class="number">2222</span>, <span class="string">&#x27;2017-09-01&#x27;</span>, <span class="number">87.5</span>),</span><br><span class="line">    (<span class="number">1001</span>, <span class="number">3333</span>, <span class="string">&#x27;2017-09-01&#x27;</span>, <span class="number">100</span>),</span><br><span class="line">    (<span class="number">1001</span>, <span class="number">4444</span>, <span class="string">&#x27;2018-09-03&#x27;</span>, <span class="keyword">null</span>),</span><br><span class="line">    (<span class="number">1001</span>, <span class="number">6666</span>, <span class="string">&#x27;2017-09-02&#x27;</span>, <span class="number">100</span>),</span><br><span class="line">    (<span class="number">1002</span>, <span class="number">1111</span>, <span class="string">&#x27;2017-09-03&#x27;</span>, <span class="number">65</span>),</span><br><span class="line">    (<span class="number">1002</span>, <span class="number">5555</span>, <span class="string">&#x27;2017-09-01&#x27;</span>, <span class="number">42</span>),</span><br><span class="line">    (<span class="number">1033</span>, <span class="number">1111</span>, <span class="string">&#x27;2017-09-03&#x27;</span>, <span class="number">92.5</span>),</span><br><span class="line">    (<span class="number">1033</span>, <span class="number">4444</span>, <span class="string">&#x27;2017-09-01&#x27;</span>, <span class="number">78</span>),</span><br><span class="line">    (<span class="number">1033</span>, <span class="number">5555</span>, <span class="string">&#x27;2017-09-01&#x27;</span>, <span class="number">82.5</span>),</span><br><span class="line">    (<span class="number">1572</span>, <span class="number">1111</span>, <span class="string">&#x27;2017-09-02&#x27;</span>, <span class="number">78</span>),</span><br><span class="line">    (<span class="number">1378</span>, <span class="number">1111</span>, <span class="string">&#x27;2017-09-05&#x27;</span>, <span class="number">82</span>),</span><br><span class="line">    (<span class="number">1378</span>, <span class="number">7777</span>, <span class="string">&#x27;2017-09-02&#x27;</span>, <span class="number">65.5</span>),</span><br><span class="line">    (<span class="number">2035</span>, <span class="number">7777</span>, <span class="string">&#x27;2018-09-03&#x27;</span>, <span class="number">88</span>),</span><br><span class="line">    (<span class="number">2035</span>, <span class="number">9999</span>, <span class="string">&#x27;2019-09-02&#x27;</span>, <span class="keyword">null</span>),</span><br><span class="line">    (<span class="number">3755</span>, <span class="number">1111</span>, <span class="string">&#x27;2019-09-02&#x27;</span>, <span class="keyword">null</span>),</span><br><span class="line">    (<span class="number">3755</span>, <span class="number">8888</span>, <span class="string">&#x27;2019-09-02&#x27;</span>, <span class="keyword">null</span>),</span><br><span class="line">    (<span class="number">3755</span>, <span class="number">9999</span>, <span class="string">&#x27;2017-09-01&#x27;</span>, <span class="number">92</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意</strong>：上面的<code>insert</code>语句使用了批处理的方式来插入数据，这种做法插入数据的效率比较高。</p>
</blockquote>
<h4 id="DQL（数据查询语言）">DQL（数据查询语言）</h4>
<p>接下来，我们完成如下所示的查询。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询所有学生的所有信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> `tb_student`;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询学生的学号、姓名和籍贯(投影)</span></span><br><span class="line"><span class="keyword">select</span> `stu_id`, `stu_name`, `stu_addr` <span class="keyword">from</span> `tb_student`;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询所有课程的名称及学分(投影和别名)</span></span><br><span class="line"><span class="keyword">select</span> `cou_name` <span class="keyword">as</span> 课程名称, `cou_credit` <span class="keyword">as</span> 学分 <span class="keyword">from</span> `tb_course`;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询所有女学生的姓名和出生日期(筛选)</span></span><br><span class="line"><span class="keyword">select</span> `stu_name`, `stu_birth` <span class="keyword">from</span> `tb_student` <span class="keyword">where</span> `stu_sex`<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询籍贯为“四川成都”的女学生的姓名和出生日期(筛选)</span></span><br><span class="line"><span class="keyword">select</span> `stu_name`, `stu_birth` <span class="keyword">from</span> `tb_student` <span class="keyword">where</span> `stu_sex`<span class="operator">=</span><span class="number">0</span> <span class="keyword">and</span> `stu_addr`<span class="operator">=</span><span class="string">&#x27;四川成都&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询籍贯为“四川成都”或者性别为“女生”的学生</span></span><br><span class="line"><span class="keyword">select</span> `stu_name`, `stu_birth` <span class="keyword">from</span> `tb_student` <span class="keyword">where</span> `stu_sex`<span class="operator">=</span><span class="number">0</span> <span class="keyword">or</span> `stu_addr`<span class="operator">=</span><span class="string">&#x27;四川成都&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询所有80后学生的姓名、性别和出生日期(筛选)</span></span><br><span class="line"><span class="keyword">select</span> `stu_name`, `stu_sex`, `stu_birth` <span class="keyword">from</span> `tb_student` </span><br><span class="line"><span class="keyword">where</span> `stu_birth`<span class="operator">&gt;=</span><span class="string">&#x27;1980-1-1&#x27;</span> <span class="keyword">and</span> `stu_birth`<span class="operator">&lt;=</span><span class="string">&#x27;1989-12-31&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> `stu_name`, `stu_sex`, `stu_birth` <span class="keyword">from</span> `tb_student` </span><br><span class="line"><span class="keyword">where</span> `stu_birth` <span class="keyword">between</span> <span class="string">&#x27;1980-1-1&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;1989-12-31&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 补充：将表示性别的 1 和 0 处理成 “男” 和 “女”</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">    `stu_name` <span class="keyword">as</span> 姓名, </span><br><span class="line">    if(`stu_sex`, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>) <span class="keyword">as</span> 性别, </span><br><span class="line">    `stu_birth` <span class="keyword">as</span> 出生日期</span><br><span class="line"><span class="keyword">from</span> `tb_student` </span><br><span class="line"><span class="keyword">where</span> `stu_birth` <span class="keyword">between</span> <span class="string">&#x27;1980-1-1&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;1989-12-31&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">    `stu_name` <span class="keyword">as</span> 姓名, </span><br><span class="line">    <span class="keyword">case</span> `stu_sex` <span class="keyword">when</span> <span class="number">1</span> <span class="keyword">then</span> <span class="string">&#x27;男&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;女&#x27;</span> <span class="keyword">end</span> <span class="keyword">as</span> 性别, </span><br><span class="line">    `stu_birth` <span class="keyword">as</span> 出生日期</span><br><span class="line"><span class="keyword">from</span> `tb_student` </span><br><span class="line"><span class="keyword">where</span> `stu_birth` <span class="keyword">between</span> <span class="string">&#x27;1980-1-1&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;1989-12-31&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询学分大于2的课程的名称和学分(筛选)</span></span><br><span class="line"><span class="keyword">select</span> `cou_name`, `cou_credit` <span class="keyword">from</span> `tb_course` <span class="keyword">where</span> `cou_credit`<span class="operator">&gt;</span><span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询学分是奇数的课程的名称和学分(筛选)</span></span><br><span class="line"><span class="keyword">select</span> `cou_name`, `cou_credit` <span class="keyword">from</span> `tb_course` <span class="keyword">where</span> `cou_credit`<span class="operator">%</span><span class="number">2</span><span class="operator">&lt;&gt;</span><span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> `cou_name`, `cou_credit` <span class="keyword">from</span> `tb_course` <span class="keyword">where</span> `cou_credit` mod <span class="number">2</span><span class="operator">&lt;&gt;</span><span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询选择选了1111的课程考试成绩在90分以上的学生学号(筛选)</span></span><br><span class="line"><span class="keyword">select</span> `stu_id` <span class="keyword">from</span> `tb_record` <span class="keyword">where</span> `cou_id`<span class="operator">=</span><span class="number">1111</span> <span class="keyword">and</span> `score`<span class="operator">&gt;</span><span class="number">90</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询名字叫“杨过”的学生的姓名和性别</span></span><br><span class="line"><span class="keyword">select</span> `stu_name`, `stu_sex` <span class="keyword">from</span> `tb_student` <span class="keyword">where</span> `stu_name`<span class="operator">=</span><span class="string">&#x27;杨过&#x27;</span>;</span><br><span class="line">    </span><br><span class="line"><span class="comment">-- 查询姓“杨”的学生姓名和性别(模糊)</span></span><br><span class="line"><span class="comment">-- % - 通配符（wildcard），它可以匹配0个或任意多个字符</span></span><br><span class="line"><span class="keyword">select</span> `stu_name`, `stu_sex` <span class="keyword">from</span> `tb_student` <span class="keyword">where</span> `stu_name` <span class="keyword">like</span> <span class="string">&#x27;杨%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询姓“杨”名字两个字的学生姓名和性别(模糊)</span></span><br><span class="line"><span class="comment">-- _ - 通配符（wildcard），它可以精确匹配一个字符</span></span><br><span class="line"><span class="keyword">select</span> `stu_name`, `stu_sex` <span class="keyword">from</span> `tb_student` <span class="keyword">where</span> `stu_name` <span class="keyword">like</span> <span class="string">&#x27;杨_&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询姓“杨”名字三个字的学生姓名和性别(模糊)</span></span><br><span class="line"><span class="keyword">select</span> `stu_name`, `stu_sex` <span class="keyword">from</span> `tb_student` <span class="keyword">where</span> `stu_name` <span class="keyword">like</span> <span class="string">&#x27;杨__&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询名字中有“不”字或“嫣”字的学生的姓名(模糊)</span></span><br><span class="line"><span class="keyword">select</span> `stu_name` <span class="keyword">from</span> `tb_student` <span class="keyword">where</span> `stu_name` <span class="keyword">like</span> <span class="string">&#x27;%不%&#x27;</span> <span class="keyword">or</span> `stu_name` <span class="keyword">like</span> <span class="string">&#x27;%嫣%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 将“岳不群”改名为“岳不嫣”，比较下面两个查询的区别</span></span><br><span class="line"><span class="keyword">update</span> `tb_student` <span class="keyword">set</span> `stu_name`<span class="operator">=</span><span class="string">&#x27;岳不嫣&#x27;</span> <span class="keyword">where</span> `stu_id`<span class="operator">=</span><span class="number">1572</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> `stu_name` <span class="keyword">from</span> `tb_student` <span class="keyword">where</span> `stu_name` <span class="keyword">like</span> <span class="string">&#x27;%不%&#x27;</span></span><br><span class="line"><span class="keyword">union</span> </span><br><span class="line"><span class="keyword">select</span> `stu_name` <span class="keyword">from</span> `tb_student` <span class="keyword">where</span> `stu_name` <span class="keyword">like</span> <span class="string">&#x27;%嫣%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> `stu_name` <span class="keyword">from</span> `tb_student` <span class="keyword">where</span> `stu_name` <span class="keyword">like</span> <span class="string">&#x27;%不%&#x27;</span></span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span> </span><br><span class="line"><span class="keyword">select</span> `stu_name` <span class="keyword">from</span> `tb_student` <span class="keyword">where</span> `stu_name` <span class="keyword">like</span> <span class="string">&#x27;%嫣%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询姓“杨”或姓“林”名字三个字的学生的姓名(正则表达式模糊查询)</span></span><br><span class="line"><span class="keyword">select</span> `stu_name` <span class="keyword">from</span> `tb_student` <span class="keyword">where</span> `stu_name` regexp <span class="string">&#x27;[杨林].&#123;2&#125;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询没有录入籍贯的学生姓名(空值处理)</span></span><br><span class="line"><span class="keyword">select</span> `stu_name` <span class="keyword">from</span> `tb_student` <span class="keyword">where</span> `stu_addr` <span class="keyword">is</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> `stu_name` <span class="keyword">from</span> `tb_student` <span class="keyword">where</span> `stu_addr` <span class="operator">&lt;=&gt;</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询录入了籍贯的学生姓名(空值处理)</span></span><br><span class="line"><span class="keyword">select</span> `stu_name` <span class="keyword">from</span> `tb_student` <span class="keyword">where</span> `stu_addr` <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 下面的查询什么也查不到，三值逻辑 --&gt; true / false / unknown</span></span><br><span class="line"><span class="keyword">select</span> `stu_name` <span class="keyword">from</span> `tb_student` <span class="keyword">where</span> `stu_addr`<span class="operator">=</span><span class="keyword">null</span> <span class="keyword">or</span> `stu_addr`<span class="operator">&lt;&gt;</span><span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询学生选课的所有日期(去重)</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> `sel_date` <span class="keyword">from</span> `tb_record`;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询学生的籍贯(去重)</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> `stu_addr` <span class="keyword">from</span> `tb_student` <span class="keyword">where</span> `stu_addr` <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询男学生的姓名和生日按年龄从大到小排列(排序)</span></span><br><span class="line"><span class="comment">-- 升序：从小到大 - asc，降序：从大到小 - desc</span></span><br><span class="line"><span class="keyword">select</span> `stu_id`, `stu_name`, `stu_birth` <span class="keyword">from</span> `tb_student` </span><br><span class="line"><span class="keyword">where</span> `stu_sex`<span class="operator">=</span><span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> `stu_birth` <span class="keyword">asc</span>, `stu_id` <span class="keyword">desc</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 补充：将上面的生日换算成年龄(日期函数、数值函数)</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">    `stu_id` <span class="keyword">as</span> 学号,</span><br><span class="line">    `stu_name` <span class="keyword">as</span> 姓名, </span><br><span class="line">    <span class="built_in">floor</span>(datediff(curdate(), `stu_birth`)<span class="operator">/</span><span class="number">365</span>) <span class="keyword">as</span> 年龄</span><br><span class="line"><span class="keyword">from</span> `tb_student` </span><br><span class="line"><span class="keyword">where</span> `stu_sex`<span class="operator">=</span><span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> 年龄 <span class="keyword">desc</span>, `stu_id` <span class="keyword">desc</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询年龄最大的学生的出生日期(聚合函数)</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">min</span>(`stu_birth`) <span class="keyword">from</span> `tb_student`;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询年龄最小的学生的出生日期(聚合函数)</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">max</span>(`stu_birth`) <span class="keyword">from</span> `tb_student`;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询编号为1111的课程考试成绩的最高分(聚合函数)</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">max</span>(`score`) <span class="keyword">from</span> `tb_record` <span class="keyword">where</span> `cou_id`<span class="operator">=</span><span class="number">1111</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询学号为1001的学生考试成绩的最低分(聚合函数)</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">min</span>(`score`) <span class="keyword">from</span> `tb_record` <span class="keyword">where</span> `stu_id`<span class="operator">=</span><span class="number">1001</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询学号为1001的学生考试成绩的平均分(聚合函数)</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">avg</span>(`score`) <span class="keyword">from</span> `tb_record` <span class="keyword">where</span> `stu_id`<span class="operator">=</span><span class="number">1001</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">sum</span>(`score`) <span class="operator">/</span> <span class="built_in">count</span>(`score`) <span class="keyword">from</span> `tb_record` <span class="keyword">where</span> `stu_id`<span class="operator">=</span><span class="number">1001</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询学号为1001的学生考试成绩的平均分，如果有null值，null值算0分(聚合函数)</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">sum</span>(`score`) <span class="operator">/</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> `tb_record` <span class="keyword">where</span> `stu_id`<span class="operator">=</span><span class="number">1001</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">avg</span>(ifnull(`score`, <span class="number">0</span>)) <span class="keyword">from</span> `tb_record` <span class="keyword">where</span> `stu_id`<span class="operator">=</span><span class="number">1001</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询学号为1001的学生考试成绩的标准差(聚合函数)</span></span><br><span class="line"><span class="keyword">select</span> std(`score`), variance(`score`) <span class="keyword">from</span> `tb_record` <span class="keyword">where</span> `stu_id`<span class="operator">=</span><span class="number">1001</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询男女学生的人数(分组和聚合函数)</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">    <span class="keyword">case</span> `stu_sex` <span class="keyword">when</span> <span class="number">1</span> <span class="keyword">then</span> <span class="string">&#x27;男&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;女&#x27;</span> <span class="keyword">end</span> <span class="keyword">as</span> 性别,</span><br><span class="line">    <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> 人数</span><br><span class="line"><span class="keyword">from</span> `tb_student` <span class="keyword">group</span> <span class="keyword">by</span> `stu_sex`;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询每个学院学生人数(分组和聚合函数)</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">    `col_id` <span class="keyword">as</span> 学院,</span><br><span class="line">    <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> 人数</span><br><span class="line"><span class="keyword">from</span> `tb_student` <span class="keyword">group</span> <span class="keyword">by</span> `col_id` <span class="keyword">with</span> <span class="keyword">rollup</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询每个学院男女学生人数(分组和聚合函数)</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">    `col_id` <span class="keyword">as</span> 学院,</span><br><span class="line">    if(`stu_sex`, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>) <span class="keyword">as</span> 性别,</span><br><span class="line">    <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> 人数</span><br><span class="line"><span class="keyword">from</span> `tb_student` <span class="keyword">group</span> <span class="keyword">by</span> `col_id`, `stu_sex`;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询每个学生的学号和平均成绩(分组和聚合函数)</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">    `stu_id`, </span><br><span class="line">    round(<span class="built_in">avg</span>(`score`), <span class="number">1</span>) <span class="keyword">as</span> avg_score</span><br><span class="line"><span class="keyword">from</span> `tb_record` <span class="keyword">group</span> <span class="keyword">by</span> `stu_id`;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询平均成绩大于等于90分的学生的学号和平均成绩</span></span><br><span class="line"><span class="comment">-- 分组以前的筛选使用where子句，分组以后的筛选使用having子句</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">    `stu_id`, </span><br><span class="line">    round(<span class="built_in">avg</span>(`score`), <span class="number">1</span>) <span class="keyword">as</span> avg_score</span><br><span class="line"><span class="keyword">from</span> `tb_record`</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> `stu_id` <span class="keyword">having</span> avg_score<span class="operator">&gt;=</span><span class="number">90</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询1111、2222、3333三门课程平均成绩大于等于90分的学生的学号和平均成绩</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">    `stu_id`, </span><br><span class="line">    round(<span class="built_in">avg</span>(`score`), <span class="number">1</span>) <span class="keyword">as</span> avg_score</span><br><span class="line"><span class="keyword">from</span> `tb_record` <span class="keyword">where</span> `cou_id` <span class="keyword">in</span> (<span class="number">1111</span>, <span class="number">2222</span>, <span class="number">3333</span>)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> `stu_id` <span class="keyword">having</span> avg_score<span class="operator">&gt;=</span><span class="number">90</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询年龄最大的学生的姓名(子查询/嵌套查询)</span></span><br><span class="line"><span class="comment">-- 嵌套查询：把一个select的结果作为另一个select的一部分来使用</span></span><br><span class="line"><span class="keyword">select</span> `stu_name` <span class="keyword">from</span> `tb_student` </span><br><span class="line"><span class="keyword">where</span> `stu_birth`<span class="operator">=</span>(</span><br><span class="line">    <span class="keyword">select</span> <span class="built_in">min</span>(`stu_birth`) <span class="keyword">from</span> `tb_student`</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询选了两门以上的课程的学生姓名(子查询/分组条件/集合运算)</span></span><br><span class="line"><span class="keyword">select</span> `stu_name` <span class="keyword">from</span> `tb_student` </span><br><span class="line"><span class="keyword">where</span> `stu_id` <span class="keyword">in</span> (</span><br><span class="line">    <span class="keyword">select</span> `stu_id` <span class="keyword">from</span> `tb_record` </span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> `stu_id` <span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">&gt;</span><span class="number">2</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询学生的姓名、生日和所在学院名称</span></span><br><span class="line"><span class="keyword">select</span> `stu_name`, `stu_birth`, `col_name` </span><br><span class="line"><span class="keyword">from</span> `tb_student`, `tb_college` </span><br><span class="line"><span class="keyword">where</span> `tb_student`.`col_id`<span class="operator">=</span>`tb_college`.`col_id`;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> `stu_name`, `stu_birth`, `col_name` </span><br><span class="line"><span class="keyword">from</span> `tb_student` <span class="keyword">inner</span> <span class="keyword">join</span> `tb_college` </span><br><span class="line"><span class="keyword">on</span> `tb_student`.`col_id`<span class="operator">=</span>`tb_college`.`col_id`;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> `stu_name`, `stu_birth`, `col_name` </span><br><span class="line"><span class="keyword">from</span> `tb_student` <span class="keyword">natural</span> <span class="keyword">join</span> `tb_college`;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询学生姓名、课程名称以及成绩(连接查询/联结查询)</span></span><br><span class="line"><span class="keyword">select</span> `stu_name`, `cou_name`, `score` </span><br><span class="line"><span class="keyword">from</span> `tb_student`, `tb_course`, `tb_record` </span><br><span class="line"><span class="keyword">where</span> `tb_student`.`stu_id`<span class="operator">=</span>`tb_record`.`stu_id` </span><br><span class="line"><span class="keyword">and</span> `tb_course`.`cou_id`<span class="operator">=</span>`tb_record`.`cou_id` </span><br><span class="line"><span class="keyword">and</span> `score` <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> `stu_name`, `cou_name`, `score` <span class="keyword">from</span> `tb_student` </span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> `tb_record` <span class="keyword">on</span> `tb_student`.`stu_id`<span class="operator">=</span>`tb_record`.`stu_id` </span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> `tb_course` <span class="keyword">on</span> `tb_course`.`cou_id`<span class="operator">=</span>`tb_record`.`cou_id` </span><br><span class="line"><span class="keyword">where</span> `score` <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> `stu_name`, `cou_name`, `score` <span class="keyword">from</span> `tb_student` </span><br><span class="line"><span class="keyword">natural</span> <span class="keyword">join</span> `tb_record` </span><br><span class="line"><span class="keyword">natural</span> <span class="keyword">join</span> `tb_course`</span><br><span class="line"><span class="keyword">where</span> `score` <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 补充：上面的查询结果取前5条数据(分页查询)</span></span><br><span class="line"><span class="keyword">select</span> `stu_name`, `cou_name`, `score` </span><br><span class="line"><span class="keyword">from</span> `tb_student`, `tb_course`, `tb_record` </span><br><span class="line"><span class="keyword">where</span> `tb_student`.`stu_id`<span class="operator">=</span>`tb_record`.`stu_id` </span><br><span class="line"><span class="keyword">and</span> `tb_course`.`cou_id`<span class="operator">=</span>`tb_record`.`cou_id` </span><br><span class="line"><span class="keyword">and</span> `score` <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span> </span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> `score` <span class="keyword">desc</span> </span><br><span class="line">limit <span class="number">0</span>,<span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 补充：上面的查询结果取第6-10条数据(分页查询)</span></span><br><span class="line"><span class="keyword">select</span> `stu_name`, `cou_name`, `score` </span><br><span class="line"><span class="keyword">from</span> `tb_student`, `tb_course`, `tb_record` </span><br><span class="line"><span class="keyword">where</span> `tb_student`.`stu_id`<span class="operator">=</span>`tb_record`.`stu_id` </span><br><span class="line"><span class="keyword">and</span> `tb_course`.`cou_id`<span class="operator">=</span>`tb_record`.`cou_id` </span><br><span class="line"><span class="keyword">and</span> `score` <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span> </span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> `score` <span class="keyword">desc</span> </span><br><span class="line">limit <span class="number">5</span> <span class="keyword">offset</span> <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 补充：上面的查询结果取第11-15条数据(分页查询)</span></span><br><span class="line"><span class="keyword">select</span> `stu_name`, `cou_name`, `score` </span><br><span class="line"><span class="keyword">from</span> `tb_student`, `tb_course`, `tb_record` </span><br><span class="line"><span class="keyword">where</span> `tb_student`.`stu_id`<span class="operator">=</span>`tb_record`.`stu_id` </span><br><span class="line"><span class="keyword">and</span> `tb_course`.`cou_id`<span class="operator">=</span>`tb_record`.`cou_id` </span><br><span class="line"><span class="keyword">and</span> `score` <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span> </span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> `score` <span class="keyword">desc</span> </span><br><span class="line">limit <span class="number">5</span> <span class="keyword">offset</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询选课学生的姓名和平均成绩(子查询和连接查询)</span></span><br><span class="line"><span class="keyword">select</span> `stu_name`, `avg_score` </span><br><span class="line"><span class="keyword">from</span> `tb_student` <span class="keyword">inner</span> <span class="keyword">join</span> (</span><br><span class="line">    <span class="keyword">select</span> `stu_id` <span class="keyword">as</span> `sid`, round(<span class="built_in">avg</span>(`score`), <span class="number">1</span>) <span class="keyword">as</span> avg_score </span><br><span class="line">    <span class="keyword">from</span> `tb_record` <span class="keyword">group</span> <span class="keyword">by</span> `stu_id`</span><br><span class="line">) <span class="keyword">as</span> `t2` <span class="keyword">on</span> `stu_id`<span class="operator">=</span>`sid`;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询学生的姓名和选课的数量</span></span><br><span class="line"><span class="keyword">select</span> `stu_name`, `total` <span class="keyword">from</span> `tb_student` <span class="keyword">as</span> `t1`</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> (</span><br><span class="line">    <span class="keyword">select</span> `stu_id`, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> `total`</span><br><span class="line">    <span class="keyword">from</span> `tb_record` <span class="keyword">group</span> <span class="keyword">by</span> `stu_id`</span><br><span class="line">) <span class="keyword">as</span> `t2` <span class="keyword">on</span> `t1`.`stu_id`<span class="operator">=</span>`t2`.`stu_id`;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询每个学生的姓名和选课数量(左外连接和子查询)</span></span><br><span class="line"><span class="comment">-- 左外连接：左表（写在join左边的表）的每条记录都可以查出来，不满足连表条件的地方填充null。</span></span><br><span class="line"><span class="keyword">select</span> `stu_name`, <span class="built_in">coalesce</span>(`total`, <span class="number">0</span>) <span class="keyword">as</span> `total`</span><br><span class="line"><span class="keyword">from</span> `tb_student` <span class="keyword">as</span> `t1`</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> (</span><br><span class="line">    <span class="keyword">select</span> `stu_id`, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> `total`</span><br><span class="line">    <span class="keyword">from</span> `tb_record` <span class="keyword">group</span> <span class="keyword">by</span> `stu_id`</span><br><span class="line">) <span class="keyword">as</span> `t2` <span class="keyword">on</span> `t1`.`stu_id`<span class="operator">=</span>`t2`.`stu_id`;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改选课记录表，去掉 stu_id 列的外键约束</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> `tb_record` <span class="keyword">drop</span> <span class="keyword">foreign</span> key `fk_record_stu_id`;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入两条新纪录（注意：没有学号为 5566 的学生）</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `tb_record` </span><br><span class="line"><span class="keyword">values</span></span><br><span class="line">    (<span class="keyword">default</span>, <span class="number">5566</span>, <span class="number">1111</span>, <span class="string">&#x27;2019-09-02&#x27;</span>, <span class="number">80</span>),</span><br><span class="line">    (<span class="keyword">default</span>, <span class="number">5566</span>, <span class="number">2222</span>, <span class="string">&#x27;2019-09-02&#x27;</span>, <span class="number">70</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 右外连接：右表（写在join右边的表）的每条记录都可以查出来，不满足连表条件的地方填充null。</span></span><br><span class="line"><span class="keyword">select</span> `stu_name`, `total` <span class="keyword">from</span> `tb_student` <span class="keyword">as</span> `t1`</span><br><span class="line"><span class="keyword">right</span> <span class="keyword">outer</span> <span class="keyword">join</span> (</span><br><span class="line">    <span class="keyword">select</span> `stu_id`, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> `total`</span><br><span class="line">    <span class="keyword">from</span> `tb_record` <span class="keyword">group</span> <span class="keyword">by</span> `stu_id`</span><br><span class="line">) <span class="keyword">as</span> `t2` <span class="keyword">on</span> `t1`.`stu_id`<span class="operator">=</span>`t2`.`stu_id`;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 全外连接：左表和右表的每条记录都可以查出来，不满足连表条件的地方填充null。</span></span><br><span class="line"><span class="comment">-- 说明：MySQL不支持全外连接，所以用左外连接和右外连接的并集来表示。</span></span><br><span class="line"><span class="keyword">select</span> `stu_name`, `total`</span><br><span class="line"><span class="keyword">from</span> `tb_student` <span class="keyword">as</span> `t1`</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> (</span><br><span class="line">    <span class="keyword">select</span> `stu_id`, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> `total`</span><br><span class="line">    <span class="keyword">from</span> `tb_record` <span class="keyword">group</span> <span class="keyword">by</span> `stu_id`</span><br><span class="line">) <span class="keyword">as</span> `t2` <span class="keyword">on</span> `t1`.`stu_id`<span class="operator">=</span>`t2`.`stu_id`</span><br><span class="line"><span class="keyword">union</span> </span><br><span class="line"><span class="keyword">select</span> `stu_name`, `total` <span class="keyword">from</span> `tb_student` <span class="keyword">as</span> `t1`</span><br><span class="line"><span class="keyword">right</span> <span class="keyword">outer</span> <span class="keyword">join</span> (</span><br><span class="line">    <span class="keyword">select</span> `stu_id`, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> `total`</span><br><span class="line">    <span class="keyword">from</span> `tb_record` <span class="keyword">group</span> <span class="keyword">by</span> `stu_id`</span><br><span class="line">) <span class="keyword">as</span> `t2` <span class="keyword">on</span> `t1`.`stu_id`<span class="operator">=</span>`t2`.`stu_id`;</span><br></pre></td></tr></table></figure>
<p>上面的DML有几个地方需要加以说明：</p>
<ol>
<li>
<p>MySQL目前的版本不支持全外连接，上面我们通过<code>union</code>操作，将左外连接和右外连接的结果求并集实现全外连接的效果。大家可以通过下面的图来加深对连表操作的认识。</p>
<img src="https://gitee.com/jackfrued/mypic/raw/master/20211121135117.png" style="zoom:50%">
</li>
<li>
<p>MySQL 中支持多种类型的运算符，包括：算术运算符（<code>+</code>、<code>-</code>、<code>*</code>、<code>/</code>、<code>%</code>）、比较运算符（<code>=</code>、<code>&lt;&gt;</code>、<code>&lt;=&gt;</code>、<code>&lt;</code>、<code>&lt;=</code>、<code>&gt;</code>、<code>&gt;=</code>、<code>BETWEEN...AND..</code>.、<code>IN</code>、<code>IS NULL</code>、<code>IS NOT NULL</code>、<code>LIKE</code>、<code>RLIKE</code>、<code>REGEXP</code>）、逻辑运算符（<code>NOT</code>、<code>AND</code>、<code>OR</code>、<code>XOR</code>）和位运算符（<code>&amp;</code>、<code>|</code>、<code>^</code>、<code>~</code>、<code>&gt;&gt;</code>、<code>&lt;&lt;</code>），我们可以在 DML 中使用这些运算符处理数据。</p>
</li>
<li>
<p>在查询数据时，可以在<code>SELECT</code>语句及其子句（如<code>WHERE</code>子句、<code>ORDER BY</code>子句、<code>HAVING</code>子句等）中使用函数，这些函数包括字符串函数、数值函数、时间日期函数、流程函数等，如下面的表格所示。</p>
<p>常用字符串函数。</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CONCAT</code></td>
<td>将多个字符串连接成一个字符串</td>
</tr>
<tr>
<td><code>FORMAT</code></td>
<td>将数值格式化成字符串并指定保留几位小数</td>
</tr>
<tr>
<td><code>FROM_BASE64</code> / <code>TO_BASE64</code></td>
<td>BASE64解码/编码</td>
</tr>
<tr>
<td><code>BIN</code> / <code>OCT</code> / <code>HEX</code></td>
<td>将数值转换成二进制/八进制/十六进制字符串</td>
</tr>
<tr>
<td><code>LOCATE</code></td>
<td>在字符串中查找一个子串的位置</td>
</tr>
<tr>
<td><code>LEFT</code> / <code>RIGHT</code></td>
<td>返回一个字符串左边/右边指定长度的字符</td>
</tr>
<tr>
<td><code>LENGTH</code> / <code>CHAR_LENGTH</code></td>
<td>返回字符串的长度以字节/字符为单位</td>
</tr>
<tr>
<td><code>LOWER</code> / <code>UPPER</code></td>
<td>返回字符串的小写/大写形式</td>
</tr>
<tr>
<td><code>LPAD</code> / <code>RPAD</code></td>
<td>如果字符串的长度不足，在字符串左边/右边填充指定的字符</td>
</tr>
<tr>
<td><code>LTRIM</code> / <code>RTRIM</code></td>
<td>去掉字符串前面/后面的空格</td>
</tr>
<tr>
<td><code>ORD</code> / <code>CHAR</code></td>
<td>返回字符对应的编码/返回编码对应的字符</td>
</tr>
<tr>
<td><code>STRCMP</code></td>
<td>比较字符串，返回-1、0、1分别表示小于、等于、大于</td>
</tr>
<tr>
<td><code>SUBSTRING</code></td>
<td>返回字符串指定范围的子串</td>
</tr>
</tbody>
</table>
<p>常用数值函数。</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ABS</code></td>
<td>返回一个数的绝度值</td>
</tr>
<tr>
<td><code>CEILING</code> / <code>FLOOR</code></td>
<td>返回一个数上取整/下取整的结果</td>
</tr>
<tr>
<td><code>CONV</code></td>
<td>将一个数从一种进制转换成另一种进制</td>
</tr>
<tr>
<td><code>CRC32</code></td>
<td>计算循环冗余校验码</td>
</tr>
<tr>
<td><code>EXP</code> / <code>LOG</code> / <code>LOG2</code> / <code>LOG10</code></td>
<td>计算指数/对数</td>
</tr>
<tr>
<td><code>POW</code></td>
<td>求幂</td>
</tr>
<tr>
<td><code>RAND</code></td>
<td>返回[0,1)范围的随机数</td>
</tr>
<tr>
<td><code>ROUND</code></td>
<td>返回一个数四舍五入后的结果</td>
</tr>
<tr>
<td><code>SQRT</code></td>
<td>返回一个数的平方根</td>
</tr>
<tr>
<td><code>TRUNCATE</code></td>
<td>截断一个数到指定的精度</td>
</tr>
<tr>
<td><code>SIN</code> / <code>COS</code> / <code>TAN</code> / <code>COT</code> / <code>ASIN</code> / <code>ACOS</code> / <code>ATAN</code></td>
<td>三角函数</td>
</tr>
</tbody>
</table>
<p>常用时间日期函数。</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CURDATE</code> / <code>CURTIME</code> / <code>NOW</code></td>
<td>获取当前日期/时间/日期和时间</td>
</tr>
<tr>
<td><code>ADDDATE</code> / <code>SUBDATE</code></td>
<td>将两个日期表达式相加/相减并返回结果</td>
</tr>
<tr>
<td><code>DATE</code> / <code>TIME</code></td>
<td>从字符串中获取日期/时间</td>
</tr>
<tr>
<td><code>YEAR</code> / <code>MONTH</code> / <code>DAY</code></td>
<td>从日期中获取年/月/日</td>
</tr>
<tr>
<td><code>HOUR</code> / <code>MINUTE</code> / <code>SECOND</code></td>
<td>从时间中获取时/分/秒</td>
</tr>
<tr>
<td><code>DATEDIFF</code> / <code>TIMEDIFF</code></td>
<td>返回两个时间日期表达式相差多少天/小时</td>
</tr>
<tr>
<td><code>MAKEDATE</code> / <code>MAKETIME</code></td>
<td>制造一个日期/时间</td>
</tr>
</tbody>
</table>
<p>常用流程函数。</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>IF</code></td>
<td>根据条件是否成立返回不同的值</td>
</tr>
<tr>
<td><code>IFNULL</code></td>
<td>如果为NULL则返回指定的值否则就返回本身</td>
</tr>
<tr>
<td><code>NULLIF</code></td>
<td>两个表达式相等就返回NULL否则返回第一个表达式的值</td>
</tr>
</tbody>
</table>
<p>其他常用函数。</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>MD5</code> / <code>SHA1</code> / <code>SHA2</code></td>
<td>返回字符串对应的哈希摘要</td>
</tr>
<tr>
<td><code>CHARSET</code> / <code>COLLATION</code></td>
<td>返回字符集/校对规则</td>
</tr>
<tr>
<td><code>USER</code> / <code>CURRENT_USER</code></td>
<td>返回当前用户</td>
</tr>
<tr>
<td><code>DATABASE</code></td>
<td>返回当前数据库名</td>
</tr>
<tr>
<td><code>VERSION</code></td>
<td>返回当前数据库版本</td>
</tr>
<tr>
<td><code>FOUND_ROWS</code> / <code>ROW_COUNT</code></td>
<td>返回查询到的行数/受影响的行数</td>
</tr>
<tr>
<td><code>LAST_INSERT_ID</code></td>
<td>返回最后一个自增主键的值</td>
</tr>
<tr>
<td><code>UUID</code> / <code>UUID_SHORT</code></td>
<td>返回全局唯一标识符</td>
</tr>
</tbody>
</table>
</li>
</ol>
<h4 id="DCL（数据控制语言）">DCL（数据控制语言）</h4>
<p>数据控制语言用于给指定的用户授权或者从召回指定用户的指定权限，这组操作对数据库管理员来说比较重要，将一个用户的权限最小化（刚好够用）是非常重要的，对数据库的安全至关重要。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建名为 wangdachui 的账号并为其指定口令，允许该账号从任意主机访问</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;wangdachui&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 授权 wangdachui 可以对名为school的数据库执行 select 和 insert 操作</span></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span>, <span class="keyword">insert</span> <span class="keyword">on</span> `school`.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;wangdachui&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 召回 wangdachui 对school数据库的 insert 权限</span></span><br><span class="line"><span class="keyword">revoke</span> <span class="keyword">insert</span> <span class="keyword">on</span> `school`.<span class="operator">*</span> <span class="keyword">from</span> <span class="string">&#x27;wangdachui&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>说明</strong>：创建一个可以允许任意主机登录并且具有超级管理员权限的用户在现实中并不是一个明智的决定，因为一旦该账号的口令泄露或者被破解，数据库将会面临灾难级的风险。</p>
</blockquote>
<h3 id="MySQL-详解">MySQL 详解</h3>
<h4 id="索引-2">索引</h4>
<p>索引是关系型数据库中用来提升查询性能最为重要的手段。关系型数据库中的索引就像一本书的目录，我们可以想象一下，如果要从一本书中找出某个知识点，但是这本书没有目录，这将是意见多么可怕的事情！我们估计得一篇一篇的翻下去，才能确定这个知识点到底在什么位置。创建索引虽然会带来存储空间上的开销，就像一本书的目录会占用一部分篇幅一样，但是在牺牲空间后换来的查询时间的减少也是非常显著的。</p>
<p>MySQL 数据库中所有数据类型的列都可以被索引。对于MySQL 8.0 版本的 InnoDB 存储引擎来说，它支持三种类型的索引，分别是 B+ 树索引、全文索引和 R 树索引。这里，我们只介绍使用得最为广泛的 B+ 树索引。使用 B+ 树的原因非常简单，因为它是目前在基于磁盘进行海量数据存储和排序上最有效率的数据结构。B+ 树是一棵<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-cn/%E5%B9%B3%E8%A1%A1%E6%A0%91">平衡树</a>，树的高度通常为3或4，但是却可以保存从百万级到十亿级的数据，而从这些数据里面查询一条数据，只需要3次或4次 I/O 操作。</p>
<p>B+ 树由根节点、中间节点和叶子节点构成，其中叶子节点用来保存排序后的数据。由于记录在索引上是排序过的，因此在一个叶子节点内查找数据时可以使用二分查找，这种查找方式效率非常的高。当数据很少的时候，B+ 树只有一个根节点，数据也就保存在根节点上。随着记录越来越多，B+ 树会发生分裂，根节点不再保存数据，而是提供了访问下一层节点的指针，帮助快速确定数据在哪个叶子节点上。</p>
<p>在创建二维表时，我们通常都会为表指定主键列，主键列上默认会创建索引，而对于 MySQL InnoDB 存储引擎来说，因为它使用的是索引组织表这种数据存储结构，所以主键上的索引就是整张表的数据，而这种索引我们也将其称之为<strong>聚集索引</strong>（clustered index）。很显然，一张表只能有一个聚集索引，否则表的数据岂不是要保存多次。我们自己创建的索引都是二级索引（secondary index），更常见的叫法是<strong>非聚集索引</strong>（non-clustered index）。通过我们自定义的非聚集索引只能定位记录的主键，在获取数据时可能需要再通过主键上的聚集索引进行查询，这种现象称为“回表”，因此通过非聚集索引检索数据通常比使用聚集索引检索数据要慢。</p>
<p>接下来我们通过一个简单的例子来说明索引的意义，比如我们要根据学生的姓名来查找学生，这个场景在实际开发中应该经常遇到，就跟通过商品名称查找商品是一个道理。我们可以使用 MySQL 的<code>explain</code>关键字来查看 SQL 的执行计划（数据库执行 SQL 语句的具体步骤）。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_student <span class="keyword">where</span> stuname<span class="operator">=</span><span class="string">&#x27;林震南&#x27;</span>\G</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: tb_student</span><br><span class="line">   partitions: NULL</span><br><span class="line">         type: ALL</span><br><span class="line">possible_keys: NULL</span><br><span class="line">          key: NULL</span><br><span class="line">      key_len: NULL</span><br><span class="line">          ref: NULL</span><br><span class="line">         rows: 11</span><br><span class="line">     filtered: 10.00</span><br><span class="line">        Extra: Using where</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>在上面的 SQL 执行计划中，有几项值得我们关注：</p>
<ol>
<li><code>select_type</code>：查询的类型。
<ul>
<li><code>SIMPLE</code>：简单 SELECT，不需要使用 UNION 操作或子查询。</li>
<li><code>PRIMARY</code>：如果查询包含子查询，最外层的 SELECT 被标记为 PRIMARY。</li>
<li><code>UNION</code>：UNION 操作中第二个或后面的 SELECT 语句。</li>
<li><code>SUBQUERY</code>：子查询中的第一个 SELECT。</li>
<li><code>DERIVED</code>：派生表的 SELECT 子查询。</li>
</ul>
</li>
<li><code>table</code>：查询对应的表。</li>
<li><code>type</code>：MySQL 在表中找到满足条件的行的方式，也称为访问类型，包括：<code>ALL</code>（全表扫描）、<code>index</code>（索引全扫描，只遍历索引树）、<code>range</code>（索引范围扫描）、<code>ref</code>（非唯一索引扫描）、<code>eq_ref</code>（唯一索引扫描）、<code>const</code> / <code>system</code>（常量级查询）、<code>NULL</code>（不需要访问表或索引）。在所有的访问类型中，很显然 ALL 是性能最差的，它代表的全表扫描是指要扫描表中的每一行才能找到匹配的行。</li>
<li><code>possible_keys</code>：MySQL 可以选择的索引，但是<strong>有可能不会使用</strong>。</li>
<li><code>key</code>：MySQL 真正使用的索引，如果为<code>NULL</code>就表示没有使用索引。</li>
<li><code>key_len</code>：使用的索引的长度，在不影响查询的情况下肯定是长度越短越好。</li>
<li><code>rows</code>：执行查询需要扫描的行数，这是一个<strong>预估值</strong>。</li>
<li><code>extra</code>：关于查询额外的信息。
<ul>
<li><code>Using filesort</code>：MySQL 无法利用索引完成排序操作。</li>
<li><code>Using index</code>：只使用索引的信息而不需要进一步查表来获取更多的信息。</li>
<li><code>Using temporary</code>：MySQL 需要使用临时表来存储结果集，常用于分组和排序。</li>
<li><code>Impossible where</code>：<code>where</code>子句会导致没有符合条件的行。</li>
<li><code>Distinct</code>：MySQL 发现第一个匹配行后，停止为当前的行组合搜索更多的行。</li>
<li><code>Using where</code>：查询的列未被索引覆盖，筛选条件并不是索引的前导列。</li>
</ul>
</li>
</ol>
<p>从上面的执行计划可以看出，当我们通过学生名字查询学生时实际上是进行了全表扫描，不言而喻这个查询性能肯定是非常糟糕的，尤其是在表中的行很多的时候。如果我们需要经常通过学生姓名来查询学生，那么就应该在学生姓名对应的列上创建索引，通过索引来加速查询。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_student_name <span class="keyword">on</span> tb_student(stuname);</span><br></pre></td></tr></table></figure>
<p>再次查看刚才的 SQL 对应的执行计划。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_student <span class="keyword">where</span> stuname<span class="operator">=</span><span class="string">&#x27;林震南&#x27;</span>\G</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: tb_student</span><br><span class="line">   partitions: NULL</span><br><span class="line">         type: ref</span><br><span class="line">possible_keys: idx_student_name</span><br><span class="line">          key: idx_student_name</span><br><span class="line">      key_len: 62</span><br><span class="line">          ref: const</span><br><span class="line">         rows: 1</span><br><span class="line">     filtered: 100.00</span><br><span class="line">        Extra: NULL</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>可以注意到，在对学生姓名创建索引后，刚才的查询已经不是全表扫描而是基于索引的查询，而且扫描的行只有唯一的一行，这显然大大的提升了查询的性能。MySQL 中还允许创建前缀索引，即对索引字段的前N个字符创建索引，这样的话可以减少索引占用的空间（但节省了空间很有可能会浪费时间，<strong>时间和空间是不可调和的矛盾</strong>），如下所示。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_student_name_1 <span class="keyword">on</span> tb_student(stuname(<span class="number">1</span>));</span><br></pre></td></tr></table></figure>
<p>上面的索引相当于是根据学生姓名的第一个字来创建的索引，我们再看看 SQL 执行计划。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_student <span class="keyword">where</span> stuname<span class="operator">=</span><span class="string">&#x27;林震南&#x27;</span>\G</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: tb_student</span><br><span class="line">   partitions: NULL</span><br><span class="line">         type: ref</span><br><span class="line">possible_keys: idx_student_name</span><br><span class="line">          key: idx_student_name</span><br><span class="line">      key_len: 5</span><br><span class="line">          ref: const</span><br><span class="line">         rows: 2</span><br><span class="line">     filtered: 100.00</span><br><span class="line">        Extra: Using where</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>不知道大家是否注意到，这一次扫描的行变成了2行，因为学生表中有两个姓“林”的学生，我们只用姓名的第一个字作为索引的话，在查询时通过索引就会找到这两行。</p>
<p>如果要删除索引，可以使用下面的SQL。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb_student <span class="keyword">drop</span> index idx_student_name;</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> index idx_student_name <span class="keyword">on</span> tb_student;</span><br></pre></td></tr></table></figure>
<p>在创建索引时，我们还可以使用复合索引、函数索引（MySQL 5.7 开始支持），用好复合索引实现<strong>索引覆盖</strong>可以减少不必要的排序和回表操作，这样就会让查询的性能成倍的提升，有兴趣的读者可以自行研究。</p>
<p>我们简单的为大家总结一下索引的设计原则：</p>
<ol>
<li><strong>最适合</strong>索引的列是出现在<strong>WHERE子句</strong>和连接子句中的列。</li>
<li>索引列的基数越大（取值多、重复值少），索引的效果就越好。</li>
<li>使用<strong>前缀索引</strong>可以减少索引占用的空间，内存中可以缓存更多的索引。</li>
<li><strong>索引不是越多越好</strong>，虽然索引加速了读操作（查询），但是写操作（增、删、改）都会变得更慢，因为数据的变化会导致索引的更新，就如同书籍章节的增删需要更新目录一样。</li>
<li>使用 InnoDB 存储引擎时，表的普通索引都会保存主键的值，所以<strong>主键要尽可能选择较短的数据类型</strong>，这样可以有效的减少索引占用的空间，提升索引的缓存效果。</li>
</ol>
<p>最后，还有一点需要说明，InnoDB 使用的 B-tree 索引，数值类型的列除了等值判断时索引会生效之外，使用<code>&gt;</code>、<code>&lt;</code>、<code>&gt;=</code>、<code>&lt;=</code>、<code>BETWEEN...AND... </code>、<code>&lt;&gt;</code>时，索引仍然生效；对于字符串类型的列，如果使用不以通配符开头的模糊查询，索引也是起作用的，但是其他的情况会导致索引失效，这就意味着很有可能会做全表查询。</p>
<h4 id="视图-2">视图</h4>
<p>视图是关系型数据库中将一组查询指令构成的结果集组合成可查询的数据表的对象。简单的说，视图就是虚拟的表，但与数据表不同的是，数据表是一种实体结构，而视图是一种虚拟结构，你也可以将视图理解为保存在数据库中被赋予名字的 SQL 语句。</p>
<p>使用视图可以获得以下好处：</p>
<ol>
<li>可以将实体数据表隐藏起来，让外部程序无法得知实际的数据结构，让访问者可以使用表的组成部分而不是整个表，降低数据库被攻击的风险。</li>
<li>在大多数的情况下视图是只读的（更新视图的操作通常都有诸多的限制），外部程序无法直接透过视图修改数据。</li>
<li>重用 SQL 语句，将高度复杂的查询包装在视图表中，直接访问该视图即可取出需要的数据；也可以将视图视为数据表进行连接查询。</li>
<li>视图可以返回与实体数据表不同格式的数据，在创建视图的时候可以对数据进行格式化处理。</li>
</ol>
<p>创建视图。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建视图</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> `vw_avg_score` </span><br><span class="line"><span class="keyword">as</span> </span><br><span class="line">    <span class="keyword">select</span> `stu_id`, round(<span class="built_in">avg</span>(`score`), <span class="number">1</span>) <span class="keyword">as</span> `avg_score` </span><br><span class="line">    <span class="keyword">from</span> `tb_record` <span class="keyword">group</span> <span class="keyword">by</span> `stu_id`;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 基于已有的视图创建视图</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> `vw_student_score` </span><br><span class="line"><span class="keyword">as</span> </span><br><span class="line">    <span class="keyword">select</span> `stu_name`, `avg_score` </span><br><span class="line">    <span class="keyword">from</span> `tb_student` <span class="keyword">natural</span> <span class="keyword">join</span> `vw_avg_score`;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>提示</strong>：因为视图不包含数据，所以每次使用视图时，都必须执行查询以获得数据，如果你使用了连接查询、嵌套查询创建了较为复杂的视图，你可能会发现查询性能下降得很厉害。因此，在使用复杂的视图前，应该进行测试以确保其性能能够满足应用的需求。</p>
</blockquote>
<p>使用视图。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> `vw_student_score` <span class="keyword">order</span> <span class="keyword">by</span> `avg_score` <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">+--------------+----------+</span><br><span class="line">| stuname      | avgscore |</span><br><span class="line">+--------------+----------+</span><br><span class="line">| 杨过         |     95.6 |</span><br><span class="line">| 任我行       |     53.5 |</span><br><span class="line">| 王语嫣       |     84.3 |</span><br><span class="line">| 纪嫣然       |     73.8 |</span><br><span class="line">| 岳不群       |     78.0 |</span><br><span class="line">| 东方不败     |     88.0 |</span><br><span class="line">| 项少龙       |     92.0 |</span><br><span class="line">+--------------+----------+</span><br></pre></td></tr></table></figure>
<p>既然视图是一张虚拟的表，那么视图的中的数据可以更新吗？视图的可更新性要视具体情况而定，以下类型的视图是不能更新的：</p>
<ol>
<li>使用了聚合函数（<code>SUM</code>、<code>MIN</code>、<code>MAX</code>、<code>AVG</code>、<code>COUNT</code>等）、<code>DISTINCT</code>、<code>GROUP BY</code>、<code>HAVING</code>、<code>UNION</code>或者<code>UNION ALL</code>的视图。</li>
<li><code>SELECT</code>中包含了子查询的视图。</li>
<li><code>FROM</code>子句中包含了一个不能更新的视图的视图。</li>
<li><code>WHERE</code>子句的子查询引用了<code>FROM</code>子句中的表的视图。</li>
</ol>
<p>删除视图。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">view</span> vw_student_score;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>说明</strong>：如果希望更新视图，可以先用上面的命令删除视图，也可以通过<code>create or replace view</code>来更新视图。</p>
</blockquote>
<p>视图的规则和限制。</p>
<ol>
<li>视图可以嵌套，可以利用从其他视图中检索的数据来构造一个新的视图。视图也可以和表一起使用。</li>
<li>创建视图时可以使用<code>order by</code>子句，但如果从视图中检索数据时也使用了<code>order by</code>，那么该视图中原先的<code>order by</code>会被覆盖。</li>
<li>视图无法使用索引，也不会激发触发器（实际开发中因为性能等各方面的考虑，通常不建议使用触发器，所以我们也不对这个概念进行介绍）的执行。</li>
</ol>
<h4 id="函数-2">函数</h4>
<p>MySQL 中的函数跟 Python 中的函数太多的差异，因为函数都是用来封装功能上相对独立且会被重复使用的代码的。如果非要找出一些差别来，那么 MySQL 中的函数是可以执行 SQL 语句的。下面的例子，我们通过自定义函数实现了截断超长字符串的功能。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> truncate_string(</span><br><span class="line">    content <span class="type">varchar</span>(<span class="number">10000</span>),</span><br><span class="line">    max_length <span class="type">int</span> unsigned</span><br><span class="line">) <span class="keyword">returns</span> <span class="type">varchar</span>(<span class="number">10000</span>) <span class="keyword">no</span> <span class="keyword">sql</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">declare</span> <span class="keyword">result</span> <span class="type">varchar</span>(<span class="number">10000</span>) <span class="keyword">default</span> content;</span><br><span class="line">    if <span class="keyword">char_length</span>(content) <span class="operator">&gt;</span> max_length <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">set</span> <span class="keyword">result</span> <span class="operator">=</span> <span class="keyword">left</span>(content, max_length);</span><br><span class="line">        <span class="keyword">set</span> <span class="keyword">result</span> <span class="operator">=</span> concat(<span class="keyword">result</span>, <span class="string">&#x27;……&#x27;</span>);</span><br><span class="line">    <span class="keyword">end</span> if;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">result</span>;</span><br><span class="line"><span class="keyword">end</span> $$</span><br><span class="line"></span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>说明1</strong>：函数声明后面的<code>no sql</code>是声明函数体并没有使用 SQL 语句；如果函数体中需要通过 SQL 读取数据，需要声明为<code>reads sql data</code>。</p>
<p><strong>说明2</strong>：定义函数前后的<code>delimiter</code>命令是为了修改定界符，因为函数体中的语句都是用<code>;</code>表示结束，如果不重新定义定界符，那么遇到的<code>;</code>的时候代码就会被截断执行，显然这不是我们想要的效果。</p>
</blockquote>
<p>在查询中调用自定义函数。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> truncate_string(<span class="string">&#x27;和我在成都的街头走一走，直到所有的灯都熄灭了也不停留&#x27;</span>, <span class="number">10</span>) <span class="keyword">as</span> short_string;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">+--------------------------------------+</span><br><span class="line">| short_string                         |</span><br><span class="line">+--------------------------------------+</span><br><span class="line">| 和我在成都的街头走一……                 |</span><br><span class="line">+--------------------------------------+</span><br></pre></td></tr></table></figure>
<h4 id="过程-2">过程</h4>
<p>过程（又称存储过程）是事先编译好存储在数据库中的一组 SQL 的集合，调用过程可以简化应用程序开发人员的工作，减少与数据库服务器之间的通信，对于提升数据操作的性能也是有帮助的。其实迄今为止，我们使用的 SQL 语句都是针对一个或多个表的单条语句，但在实际开发中经常会遇到某个操作需要多条 SQL 语句才能完成的情况。例如，电商网站在受理用户订单时，需要做以下一系列的处理。</p>
<ol>
<li>通过查询来核对库存中是否有对应的物品以及库存是否充足。</li>
<li>如果库存有物品，需要锁定库存以确保这些物品不再卖给别人， 并且要减少可用的物品数量以反映正确的库存量。</li>
<li>如果库存不足，可能需要进一步与供应商进行交互或者至少产生一条系统提示消息。</li>
<li>不管受理订单是否成功，都需要产生流水记录，而且需要给对应的用户产生一条通知信息。</li>
</ol>
<p>我们可以通过过程将复杂的操作封装起来，这样不仅有助于保证数据的一致性，而且将来如果业务发生了变动，只需要调整和修改过程即可。对于调用过程的用户来说，过程并没有暴露数据表的细节，而且执行过程比一条条的执行一组 SQL 要快得多。</p>
<p>下面的过程实现了查询某门课程的最高分、最低分和平均分。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> if <span class="keyword">exists</span> sp_score_stat;</span><br><span class="line"></span><br><span class="line">delimiter $$</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> sp_score_stat(</span><br><span class="line">	courseId <span class="type">int</span>, </span><br><span class="line">	<span class="keyword">out</span> maxScore <span class="type">decimal</span>(<span class="number">4</span>,<span class="number">1</span>), </span><br><span class="line">	<span class="keyword">out</span> minScore <span class="type">decimal</span>(<span class="number">4</span>,<span class="number">1</span>),</span><br><span class="line">	<span class="keyword">out</span> avgScore <span class="type">decimal</span>(<span class="number">4</span>,<span class="number">1</span>)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">select</span> <span class="built_in">max</span>(score) <span class="keyword">into</span> maxScore <span class="keyword">from</span> tb_record <span class="keyword">where</span> cou_id<span class="operator">=</span>courseId;</span><br><span class="line">	<span class="keyword">select</span> <span class="built_in">min</span>(score) <span class="keyword">into</span> minScore <span class="keyword">from</span> tb_record <span class="keyword">where</span> cou_id<span class="operator">=</span>courseId;</span><br><span class="line">	<span class="keyword">select</span> <span class="built_in">avg</span>(score) <span class="keyword">into</span> avgScore <span class="keyword">from</span> tb_record <span class="keyword">where</span> cou_id<span class="operator">=</span>courseId;</span><br><span class="line"><span class="keyword">end</span> $$</span><br><span class="line"></span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>说明</strong>：在定义过程时，因为可能需要书写多条 SQL，而分隔这些 SQL 需要使用分号作为分隔符，如果这个时候，仍然用分号表示整段代码结束，那么定义过程的 SQL 就会出现错误，所以上面我们用<code>delimiter $$</code>将整段代码结束的标记定义为<code>$$</code>，那么代码中的分号将不再表示整段代码的结束，整段代码只会在遇到<code>end $$</code>时才会执行。在定义完过程后，通过<code>delimiter ;</code>将结束符重新改回成分号（恢复现场）。</p>
</blockquote>
<p>上面定义的过程有四个参数，其中第一个参数是输入参数，代表课程的编号，后面的参数都是输出参数，因为过程不能定义返回值，只能通过输出参数将执行结果带出，定义输出参数的关键字是<code>out</code>，默认情况下参数都是输入参数。</p>
<p>调用过程。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">call</span> sp_score_stat(<span class="number">1111</span>, <span class="variable">@a</span>, <span class="variable">@b</span>, <span class="variable">@c</span>);</span><br></pre></td></tr></table></figure>
<p>获取输出参数的值。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="variable">@a</span> <span class="keyword">as</span> 最高分, <span class="variable">@b</span> <span class="keyword">as</span> 最低分, <span class="variable">@c</span> <span class="keyword">as</span> 平均分;</span><br></pre></td></tr></table></figure>
<p>删除过程。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> sp_score_stat;</span><br></pre></td></tr></table></figure>
<p>在过程中，我们可以定义变量、条件，可以使用分支和循环语句，可以通过游标操作查询结果，还可以使用事件调度器，这些内容我们暂时不在此处进行介绍。虽然我们说了很多过程的好处，但是在实际开发中，如果频繁的使用过程并将大量复杂的运算放到过程中，会给据库服务器造成巨大的压力，而数据库往往都是性能瓶颈所在，使用过程无疑是雪上加霜的操作。所以，对于互联网产品开发，我们一般建议让数据库只做好存储，复杂的运算和处理交给应用服务器上的程序去完成，如果应用服务器变得不堪重负了，我们可以比较容易的部署多台应用服务器来分摊这些压力。</p>
<p>如果大家对上面讲到的视图、函数、过程包括我们没有讲到的触发器这些知识有兴趣，建议大家阅读 MySQL 的入门读物<a target="_blank" rel="noopener" href="https://item.jd.com/12818982.html">《MySQL必知必会》</a>进行一般性了解即可，因为这些知识点在大家将来的工作中未必用得上，学了也可能仅仅是为了应付面试而已。</p>
<h3 id="MySQL-新特性-2">MySQL 新特性</h3>
<h4 id="JSON类型-2">JSON类型</h4>
<p>很多开发者在使用关系型数据库做数据持久化的时候，常常感到结构化的存储缺乏灵活性，因为必须事先设计好所有的列以及对应的数据类型。在业务发展和变化的过程中，如果需要修改表结构，这绝对是比较麻烦和难受的事情。从 MySQL 5.7 版本开始，MySQL引入了对 JSON 数据类型的支持（MySQL 8.0 解决了 JSON 的日志性能瓶颈问题），用好 JSON 类型，其实就是打破了关系型数据库和非关系型数据库之间的界限，为数据持久化操作带来了更多的便捷。</p>
<p>JSON 类型主要分为 JSON 对象和 JSON数组两种，如下所示。</p>
<ol>
<li>JSON 对象</li>
</ol>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;骆昊&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;tel&quot;</span><span class="punctuation">:</span> <span class="string">&quot;13122335566&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;QQ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;957658&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>JSON 数组</li>
</ol>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;骆昊&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;tel&quot;</span><span class="punctuation">:</span> <span class="string">&quot;13122335566&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;王大锤&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;QQ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123456&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<p>哪些地方需要用到JSON类型呢？举一个简单的例子，现在很多产品的用户登录都支持多种方式，例如手机号、微信、QQ、新浪微博等，但是一般情况下我们又不会要求用户提供所有的这些信息，那么用传统的设计方式，就需要设计多个列来对应多种登录方式，可能还需要允许这些列存在空值，这显然不是很好的选择；另一方面，如果产品又增加了一种登录方式，那么就必然要修改之前的表结构，这就更让人痛苦了。但是，有了 JSON 类型，刚才的问题就迎刃而解了，我们可以做出如下所示的设计。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> `tb_test`</span><br><span class="line">(</span><br><span class="line">`user_id` <span class="type">bigint</span> unsigned,</span><br><span class="line">`login_info` json,</span><br><span class="line"><span class="keyword">primary</span> key (`user_id`)</span><br><span class="line">) engine<span class="operator">=</span>innodb;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `tb_test` <span class="keyword">values</span> </span><br><span class="line">    (<span class="number">1</span>, <span class="string">&#x27;&#123;&quot;tel&quot;: &quot;13122335566&quot;, &quot;QQ&quot;: &quot;654321&quot;, &quot;wechat&quot;: &quot;jackfrued&quot;&#125;&#x27;</span>),</span><br><span class="line">    (<span class="number">2</span>, <span class="string">&#x27;&#123;&quot;tel&quot;: &quot;13599876543&quot;, &quot;weibo&quot;: &quot;wangdachui123&quot;&#125;&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>如果要查询用户的手机和微信号，可以用如下所示的 SQL 语句。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    `user_id`,</span><br><span class="line">    json_unquote(json_extract(`login_info`, <span class="string">&#x27;$.tel&#x27;</span>)) <span class="keyword">as</span> 手机号,</span><br><span class="line">    json_unquote(json_extract(`login_info`, <span class="string">&#x27;$.wechat&#x27;</span>)) <span class="keyword">as</span> 微信 </span><br><span class="line"><span class="keyword">from</span> `tb_test`;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">+---------+-------------+-----------+</span><br><span class="line">| user_id | 手机号      | 微信       |</span><br><span class="line">+---------+-------------+-----------+</span><br><span class="line">|       1 | 13122335566 | jackfrued |</span><br><span class="line">|       2 | 13599876543 | NULL      |</span><br><span class="line">+---------+-------------+-----------+</span><br></pre></td></tr></table></figure>
<p>因为支持 JSON 类型，MySQL 也提供了配套的处理 JSON 数据的函数，就像上面用到的<code>json_extract</code>和<code>json_unquote</code>。当然，上面的 SQL 还有更为便捷的写法，如下所示。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">	`user_id`,</span><br><span class="line">    `login_info` <span class="operator">-</span><span class="operator">&gt;&gt;</span> <span class="string">&#x27;$.tel&#x27;</span> <span class="keyword">as</span> 手机号,</span><br><span class="line">    `login_info` <span class="operator">-</span><span class="operator">&gt;&gt;</span> <span class="string">&#x27;$.wechat&#x27;</span> <span class="keyword">as</span> 微信</span><br><span class="line"><span class="keyword">from</span> `tb_test`;</span><br></pre></td></tr></table></figure>
<p>再举个例子，如果我们的产品要实现用户画像功能（给用户打标签），然后基于用户画像给用户推荐平台的服务或消费品之类的东西，我们也可以使用 JSON 类型来保存用户画像数据，示意代码如下所示。</p>
<p>创建画像标签表。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> `tb_tags`</span><br><span class="line">(</span><br><span class="line">`tag_id` <span class="type">int</span> unsigned <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;标签ID&#x27;</span>,</span><br><span class="line">`tag_name` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;标签名&#x27;</span>,</span><br><span class="line"><span class="keyword">primary</span> key (`tag_id`)</span><br><span class="line">) engine<span class="operator">=</span>innodb;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `tb_tags` (`tag_id`, `tag_name`) </span><br><span class="line"><span class="keyword">values</span></span><br><span class="line">    (<span class="number">1</span>, <span class="string">&#x27;70后&#x27;</span>),</span><br><span class="line">    (<span class="number">2</span>, <span class="string">&#x27;80后&#x27;</span>),</span><br><span class="line">    (<span class="number">3</span>, <span class="string">&#x27;90后&#x27;</span>),</span><br><span class="line">    (<span class="number">4</span>, <span class="string">&#x27;00后&#x27;</span>),</span><br><span class="line">    (<span class="number">5</span>, <span class="string">&#x27;爱运动&#x27;</span>),</span><br><span class="line">    (<span class="number">6</span>, <span class="string">&#x27;高学历&#x27;</span>),</span><br><span class="line">    (<span class="number">7</span>, <span class="string">&#x27;小资&#x27;</span>),</span><br><span class="line">    (<span class="number">8</span>, <span class="string">&#x27;有房&#x27;</span>),</span><br><span class="line">    (<span class="number">9</span>, <span class="string">&#x27;有车&#x27;</span>),</span><br><span class="line">    (<span class="number">10</span>, <span class="string">&#x27;爱看电影&#x27;</span>),</span><br><span class="line">    (<span class="number">11</span>, <span class="string">&#x27;爱网购&#x27;</span>),</span><br><span class="line">    (<span class="number">12</span>, <span class="string">&#x27;常点外卖&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>为用户打标签。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> `tb_users_tags`</span><br><span class="line">(</span><br><span class="line">`user_id` <span class="type">bigint</span> unsigned <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;用户ID&#x27;</span>,</span><br><span class="line">`user_tags` json <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;用户标签&#x27;</span></span><br><span class="line">) engine<span class="operator">=</span>innodb;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `tb_users_tags` <span class="keyword">values</span> </span><br><span class="line">    (<span class="number">1</span>, <span class="string">&#x27;[2, 6, 8, 10]&#x27;</span>),</span><br><span class="line">    (<span class="number">2</span>, <span class="string">&#x27;[3, 10, 12]&#x27;</span>),</span><br><span class="line">    (<span class="number">3</span>, <span class="string">&#x27;[3, 8, 9, 11]&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>接下来，我们通过一组查询来了解 JSON 类型的巧妙之处。</p>
<ol>
<li>
<p>查询爱看电影（有<code>10</code>这个标签）的用户ID。</p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> `tb_users` <span class="keyword">where</span> <span class="number">10</span> <span class="keyword">member</span> <span class="keyword">of</span> (user_tags<span class="operator">-</span><span class="operator">&gt;</span><span class="string">&#x27;$&#x27;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>查询爱看电影（有<code>10</code>这个标签）的80后（有<code>2</code>这个标签）用户ID。</p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">    select * from `tb_users` where json_contains(user_tags-&gt;&#x27;$&#x27;, &#x27;[2, 10]&#x27;);</span><br><span class="line"></span><br><span class="line">3. 查询爱看电影或80后或90后的用户ID。</span><br><span class="line"></span><br><span class="line">    ```SQL</span><br><span class="line">    select `user_id` from `tb_users_tags` where json_overlaps(user_tags-&gt;&#x27;$&#x27;, &#x27;[2, 3, 10]&#x27;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<blockquote>
<p><strong>说明</strong>：上面的查询用到了<code>member of</code>谓词和两个 JSON 函数，<code>json_contains</code>可以检查 JSON 数组是否包含了指定的元素，而<code>json_overlaps</code>可以检查 JSON 数组是否与指定的数组有重叠部分。</p>
</blockquote>
<h4 id="窗口函数-2">窗口函数</h4>
<p>MySQL 从8.0开始支持窗口函数，大多数商业数据库和一些开源数据库早已提供了对窗口函数的支持，有的也将其称之为 OLAP（联机分析和处理）函数，听名字就知道跟统计和分析相关。为了帮助大家理解窗口函数，我们先说说窗口的概念。</p>
<p>窗口可以理解为记录的集合，窗口函数也就是在满足某种条件的记录集合上执行的特殊函数，对于每条记录都要在此窗口内执行函数。窗口函数和我们上面讲到的聚合函数比较容易混淆，二者的区别主要在于聚合函数是将多条记录聚合为一条记录，窗口函数是每条记录都会执行，执行后记录条数不会变。窗口函数不仅仅是几个函数，它是一套完整的语法，函数只是该语法的一部分，基本语法如下所示：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator">&lt;</span>窗口函数<span class="operator">&gt;</span> <span class="keyword">over</span> (<span class="keyword">partition</span> <span class="keyword">by</span> <span class="operator">&lt;</span>用于分组的列名<span class="operator">&gt;</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="operator">&lt;</span>用户排序的列名<span class="operator">&gt;</span>)</span><br></pre></td></tr></table></figure>
<p>上面语法中，窗口函数的位置可以放以下两种函数：</p>
<ol>
<li>专用窗口函数，包括：<code>lead</code>、<code>lag</code>、<code>first_value</code>、<code>last_value</code>、<code>rank</code>、<code>dense_rank</code>和<code>row_number</code>等。</li>
<li>聚合函数，包括：<code>sum</code>、<code>avg</code>、<code>max</code>、<code>min</code>和<code>count</code>等。</li>
</ol>
<p>下面为大家举几个使用窗口函数的简单例子，我们先用如下所示的 SQL 建库建表。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建名为hrs的数据库并指定默认的字符集</span></span><br><span class="line"><span class="keyword">create</span> database `hrs` <span class="keyword">default</span> charset utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 切换到hrs数据库</span></span><br><span class="line">use `hrs`;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建部门表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> `tb_dept`</span><br><span class="line">(</span><br><span class="line">`dno` <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;编号&#x27;</span>,</span><br><span class="line">`dname` <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;名称&#x27;</span>,</span><br><span class="line">`dloc` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;所在地&#x27;</span>,</span><br><span class="line"><span class="keyword">primary</span> key (`dno`)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入4个部门</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `tb_dept` <span class="keyword">values</span> </span><br><span class="line">    (<span class="number">10</span>, <span class="string">&#x27;会计部&#x27;</span>, <span class="string">&#x27;北京&#x27;</span>),</span><br><span class="line">    (<span class="number">20</span>, <span class="string">&#x27;研发部&#x27;</span>, <span class="string">&#x27;成都&#x27;</span>),</span><br><span class="line">    (<span class="number">30</span>, <span class="string">&#x27;销售部&#x27;</span>, <span class="string">&#x27;重庆&#x27;</span>),</span><br><span class="line">    (<span class="number">40</span>, <span class="string">&#x27;运维部&#x27;</span>, <span class="string">&#x27;深圳&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建员工表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> `tb_emp`</span><br><span class="line">(</span><br><span class="line">`eno` <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;员工编号&#x27;</span>,</span><br><span class="line">`ename` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;员工姓名&#x27;</span>,</span><br><span class="line">`job` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;员工职位&#x27;</span>,</span><br><span class="line">`mgr` <span class="type">int</span> comment <span class="string">&#x27;主管编号&#x27;</span>,</span><br><span class="line">`sal` <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;员工月薪&#x27;</span>,</span><br><span class="line">`comm` <span class="type">int</span> comment <span class="string">&#x27;每月补贴&#x27;</span>,</span><br><span class="line">`dno` <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;所在部门编号&#x27;</span>,</span><br><span class="line"><span class="keyword">primary</span> key (`eno`),</span><br><span class="line"><span class="keyword">constraint</span> `fk_emp_mgr` <span class="keyword">foreign</span> key (`mgr`) <span class="keyword">references</span> tb_emp (`eno`),</span><br><span class="line"><span class="keyword">constraint</span> `fk_emp_dno` <span class="keyword">foreign</span> key (`dno`) <span class="keyword">references</span> tb_dept (`dno`)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入14个员工</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `tb_emp` <span class="keyword">values</span> </span><br><span class="line">    (<span class="number">7800</span>, <span class="string">&#x27;张三丰&#x27;</span>, <span class="string">&#x27;总裁&#x27;</span>, <span class="keyword">null</span>, <span class="number">9000</span>, <span class="number">1200</span>, <span class="number">20</span>),</span><br><span class="line">    (<span class="number">2056</span>, <span class="string">&#x27;乔峰&#x27;</span>, <span class="string">&#x27;分析师&#x27;</span>, <span class="number">7800</span>, <span class="number">5000</span>, <span class="number">1500</span>, <span class="number">20</span>),</span><br><span class="line">    (<span class="number">3088</span>, <span class="string">&#x27;李莫愁&#x27;</span>, <span class="string">&#x27;设计师&#x27;</span>, <span class="number">2056</span>, <span class="number">3500</span>, <span class="number">800</span>, <span class="number">20</span>),</span><br><span class="line">    (<span class="number">3211</span>, <span class="string">&#x27;张无忌&#x27;</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">2056</span>, <span class="number">3200</span>, <span class="keyword">null</span>, <span class="number">20</span>),</span><br><span class="line">    (<span class="number">3233</span>, <span class="string">&#x27;丘处机&#x27;</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">2056</span>, <span class="number">3400</span>, <span class="keyword">null</span>, <span class="number">20</span>),</span><br><span class="line">    (<span class="number">3251</span>, <span class="string">&#x27;张翠山&#x27;</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">2056</span>, <span class="number">4000</span>, <span class="keyword">null</span>, <span class="number">20</span>),</span><br><span class="line">    (<span class="number">5566</span>, <span class="string">&#x27;宋远桥&#x27;</span>, <span class="string">&#x27;会计师&#x27;</span>, <span class="number">7800</span>, <span class="number">4000</span>, <span class="number">1000</span>, <span class="number">10</span>),</span><br><span class="line">    (<span class="number">5234</span>, <span class="string">&#x27;郭靖&#x27;</span>, <span class="string">&#x27;出纳&#x27;</span>, <span class="number">5566</span>, <span class="number">2000</span>, <span class="keyword">null</span>, <span class="number">10</span>),</span><br><span class="line">    (<span class="number">3344</span>, <span class="string">&#x27;黄蓉&#x27;</span>, <span class="string">&#x27;销售主管&#x27;</span>, <span class="number">7800</span>, <span class="number">3000</span>, <span class="number">800</span>, <span class="number">30</span>),</span><br><span class="line">    (<span class="number">1359</span>, <span class="string">&#x27;胡一刀&#x27;</span>, <span class="string">&#x27;销售员&#x27;</span>, <span class="number">3344</span>, <span class="number">1800</span>, <span class="number">200</span>, <span class="number">30</span>),</span><br><span class="line">    (<span class="number">4466</span>, <span class="string">&#x27;苗人凤&#x27;</span>, <span class="string">&#x27;销售员&#x27;</span>, <span class="number">3344</span>, <span class="number">2500</span>, <span class="keyword">null</span>, <span class="number">30</span>),</span><br><span class="line">    (<span class="number">3244</span>, <span class="string">&#x27;欧阳锋&#x27;</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">3088</span>, <span class="number">3200</span>, <span class="keyword">null</span>, <span class="number">20</span>),</span><br><span class="line">    (<span class="number">3577</span>, <span class="string">&#x27;杨过&#x27;</span>, <span class="string">&#x27;会计&#x27;</span>, <span class="number">5566</span>, <span class="number">2200</span>, <span class="keyword">null</span>, <span class="number">10</span>),</span><br><span class="line">    (<span class="number">3588</span>, <span class="string">&#x27;朱九真&#x27;</span>, <span class="string">&#x27;会计&#x27;</span>, <span class="number">5566</span>, <span class="number">2500</span>, <span class="keyword">null</span>, <span class="number">10</span>);</span><br></pre></td></tr></table></figure>
<p>例子1：查询按月薪从高到低排在第4到第6名的员工的姓名和月薪。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (</span><br><span class="line">	<span class="keyword">select</span> </span><br><span class="line">		`ename`, `sal`,</span><br><span class="line">		<span class="built_in">row_number</span>() <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> `sal` <span class="keyword">desc</span>) <span class="keyword">as</span> `rank`</span><br><span class="line">	<span class="keyword">from</span> `tb_emp`</span><br><span class="line">) `temp` <span class="keyword">where</span> `rank` <span class="keyword">between</span> <span class="number">4</span> <span class="keyword">and</span> <span class="number">6</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>说明</strong>：上面使用的函数<code>row_number()</code>可以为每条记录生成一个行号，在实际工作中可以根据需要将其替换为<code>rank()</code>或<code>dense_rank()</code>函数，三者的区别可以参考官方文档或阅读<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/92654574">《通俗易懂的学会：SQL窗口函数》</a>进行了解。在MySQL 8以前的版本，我们可以通过下面的方式来完成类似的操作。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> `rank`, `ename`, `sal` <span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> <span class="variable">@a</span>:<span class="operator">=</span><span class="variable">@a</span><span class="operator">+</span><span class="number">1</span> <span class="keyword">as</span> `rank`, `ename`, `sal` </span><br><span class="line">    <span class="keyword">from</span> `tb_emp`, (<span class="keyword">select</span> <span class="variable">@a</span>:<span class="operator">=</span><span class="number">0</span>) <span class="keyword">as</span> t1 <span class="keyword">order</span> <span class="keyword">by</span> `sal` <span class="keyword">desc</span></span><br><span class="line">) t2 <span class="keyword">where</span> `rank` <span class="keyword">between</span> <span class="number">4</span> <span class="keyword">and</span> <span class="number">6</span>;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>例子2：查询每个部门月薪最高的两名的员工的姓名和部门名称。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> `ename`, `sal`, `dname` </span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> </span><br><span class="line">        `ename`, `sal`, `dno`,</span><br><span class="line">        <span class="built_in">rank</span>() <span class="keyword">over</span> (<span class="keyword">partition</span> <span class="keyword">by</span> `dno` <span class="keyword">order</span> <span class="keyword">by</span> `sal` <span class="keyword">desc</span>) <span class="keyword">as</span> `rank`</span><br><span class="line">    <span class="keyword">from</span> `tb_emp`</span><br><span class="line">) <span class="keyword">as</span> `temp` <span class="keyword">natural</span> <span class="keyword">join</span> `tb_dept` <span class="keyword">where</span> `rank`<span class="operator">&lt;=</span><span class="number">2</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：在MySQL 8以前的版本，我们可以通过下面的方式来完成类似的操作。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> `ename`, `sal`, `dname` <span class="keyword">from</span> `tb_emp` <span class="keyword">as</span> `t1` </span><br><span class="line"><span class="keyword">natural</span> <span class="keyword">join</span> `tb_dept` </span><br><span class="line"><span class="keyword">where</span> (</span><br><span class="line">   <span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> `tb_emp` <span class="keyword">as</span> `t2` </span><br><span class="line">   <span class="keyword">where</span> `t1`.`dno`<span class="operator">=</span>`t2`.`dno` <span class="keyword">and</span> `t2`.`sal`<span class="operator">&gt;</span>`t1`.`sal` </span><br><span class="line">)<span class="operator">&lt;</span><span class="number">2</span> <span class="keyword">order</span> <span class="keyword">by</span> `dno` <span class="keyword">asc</span>, `sal` <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="其他内容-2">其他内容</h3>
<h4 id="范式理论-2">范式理论</h4>
<p>范式理论是设计关系型数据库中二维表的指导思想。</p>
<ol>
<li>第一范式：数据表的每个列的值域都是由原子值组成的，不能够再分割。</li>
<li>第二范式：数据表里的所有数据都要和该数据表的键（主键与候选键）有完全依赖关系。</li>
<li>第三范式：所有非键属性都只和候选键有相关性，也就是说非键属性之间应该是独立无关的。</li>
</ol>
<blockquote>
<p><strong>说明</strong>：实际工作中，出于效率的考虑，我们在设计表时很有可能做出反范式设计，即故意降低方式级别，增加冗余数据来获得更好的操作性能。</p>
</blockquote>
<h4 id="数据完整性-2">数据完整性</h4>
<ol>
<li>
<p>实体完整性 - 每个实体都是独一无二的</p>
<ul>
<li>主键（<code>primary key</code>） / 唯一约束（<code>unique</code>）</li>
</ul>
</li>
<li>
<p>引用完整性（参照完整性）- 关系中不允许引用不存在的实体</p>
<ul>
<li>外键（<code>foreign key</code>）</li>
</ul>
</li>
<li>
<p>域（domain）完整性 - 数据是有效的</p>
<ul>
<li>
<p>数据类型及长度</p>
</li>
<li>
<p>非空约束（<code>not null</code>）</p>
</li>
<li>
<p>默认值约束（<code>default</code>）</p>
</li>
<li>
<p>检查约束（<code>check</code>）</p>
<blockquote>
<p><strong>说明</strong>：在 MySQL 8.x 以前，检查约束并不起作用。</p>
</blockquote>
</li>
</ul>
</li>
</ol>
<h4 id="数据一致性-2">数据一致性</h4>
<ol>
<li>
<p>事务：一系列对数据库进行读/写的操作，这些操作要么全都成功，要么全都失败。</p>
</li>
<li>
<p>事务的 ACID 特性</p>
<ul>
<li>原子性：事务作为一个整体被执行，包含在其中的对数据库的操作要么全部被执行，要么都不执行</li>
<li>一致性：事务应确保数据库的状态从一个一致状态转变为另一个一致状态</li>
<li>隔离性：多个事务并发执行时，一个事务的执行不应影响其他事务的执行</li>
<li>持久性：已被提交的事务对数据库的修改应该永久保存在数据库中</li>
</ul>
</li>
<li>
<p>MySQL 中的事务操作</p>
<ul>
<li>
<p>开启事务环境</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">start</span> transaction</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>提交事务</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">commit</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>回滚事务</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">rollback</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>查看事务隔离级别</p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;transaction_isolation&#x27;</span>;</span><br></pre></td></tr></table></figure>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">+-----------------------+-----------------+</span><br><span class="line">| Variable_name         | Value           |</span><br><span class="line">+-----------------------+-----------------+</span><br><span class="line">| transaction_isolation | REPEATABLE-READ |</span><br><span class="line">+-----------------------+-----------------+</span><br></pre></td></tr></table></figure>
<p>可以看出，MySQL 默认的事务隔离级别是<code>REPEATABLE-READ</code>。</p>
</li>
<li>
<p>修改（当前会话）事务隔离级别</p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span> session transaction isolation level read committed;</span><br></pre></td></tr></table></figure>
<p>重新查看事务隔离级别，结果如下所示。</p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">+-----------------------+----------------+</span><br><span class="line">| Variable_name         | Value          |</span><br><span class="line">+-----------------------+----------------+</span><br><span class="line">| transaction_isolation | READ-COMMITTED |</span><br><span class="line">+-----------------------+----------------+</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>关系型数据库的事务是一个很大的话题，因为当存在多个并发事务访问数据时，就有可能出现三类读数据的问题（脏读、不可重复读、幻读）和两类更新数据的问题（第一类丢失更新、第二类丢失更新）。想了解这五类问题的，可以阅读我发布在 CSDN 网站上的<a target="_blank" rel="noopener" href="https://blog.csdn.net/jackfrued/article/details/44921941">《Java面试题全集（上）》</a>一文的第80题。为了避免这些问题，关系型数据库底层是有对应的锁机制的，按锁定对象不同可以分为表级锁和行级锁，按并发事务锁定关系可以分为共享锁和独占锁。然而直接使用锁是非常麻烦的，为此数据库为用户提供了自动锁机制，只要用户指定适当的事务隔离级别，数据库就会通过分析 SQL 语句，然后为事务访问的资源加上合适的锁。此外，数据库还会维护这些锁通过各种手段提高系统的性能，这些对用户来说都是透明的。想了解 MySQL 事务和锁的细节知识，推荐大家阅读进阶读物<a target="_blank" rel="noopener" href="https://item.jd.com/11220393.html">《高性能MySQL》</a>，这也是数据库方面的经典书籍。</p>
<p>ANSI/ISO SQL 92标准定义了4个等级的事务隔离级别，如下表所示。需要说明的是，事务隔离级别和数据访问的并发性是对立的，事务隔离级别越高并发性就越差。所以要根据具体的应用来确定到底使用哪种事务隔离级别，这个地方没有万能的原则。</p>
<img src="https://gitee.com/jackfrued/mypic/raw/master/20211121225327.png" style="zoom:50%;">
<h3 id="总结-3">总结</h3>
<p>关于 SQL 和 MySQL 的知识肯定远远不止上面列出的这些，比如 SQL 本身的优化、MySQL 性能调优、MySQL 运维相关工具、MySQL 数据的备份和恢复、监控 MySQL 服务、部署高可用架构等，这一系列的问题在这里都没有办法逐一展开来讨论，那就留到有需要的时候再进行讲解吧，各位读者也可以自行探索。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://yuanweize.github.io">GreenSeaa</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://yuanweize.github.io/2022/08/09/Python-100-Days/Day36-40/37.SQL%E8%AF%A6%E8%A7%A3/">https://yuanweize.github.io/2022/08/09/Python-100-Days/Day36-40/37.SQL详解/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://yuanweize.github.io" target="_blank">HExLL</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Python/">Python</a><a class="post-meta__tags" href="/tags/Day36-40/">Day36-40</a></div><div class="post_share"><div class="social-share" data-image="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/08/09/Python-100-Days/Day36-40/39.Python%E7%A8%8B%E5%BA%8F%E6%8E%A5%E5%85%A5MySQL%E6%95%B0%E6%8D%AE%E5%BA%93/"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">39.Python程序接入MySQL数据库</div></div></a></div><div class="next-post pull-right"><a href="/2022/08/09/Python-100-Days/Day36-40/40.%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%B9%B3%E5%8F%B0%E5%92%8CHiveSQL/"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">40.大数据平台和HiveSQL</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/08/09/Python-100-Days/Day36-40/36.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8CMySQL%E6%A6%82%E8%BF%B0/" title="36.关系型数据库和MySQL概述"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 09-08-2022</div><div class="title">36.关系型数据库和MySQL概述</div></div></a></div><div><a href="/2022/08/09/Python-100-Days/Day36-40/38.%E6%B7%B1%E5%85%A5MySQL/" title="38.深入MySQL"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 09-08-2022</div><div class="title">38.深入MySQL</div></div></a></div><div><a href="/2022/08/09/Python-100-Days/Day36-40/39.Python%E7%A8%8B%E5%BA%8F%E6%8E%A5%E5%85%A5MySQL%E6%95%B0%E6%8D%AE%E5%BA%93/" title="39.Python程序接入MySQL数据库"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 09-08-2022</div><div class="title">39.Python程序接入MySQL数据库</div></div></a></div><div><a href="/2022/08/09/Python-100-Days/Day36-40/40.%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%B9%B3%E5%8F%B0%E5%92%8CHiveSQL/" title="40.大数据平台和HiveSQL"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 09-08-2022</div><div class="title">40.大数据平台和HiveSQL</div></div></a></div><div><a href="/2022/08/09/Python-100-Days/Day36-40/NoSQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%85%A5%E9%97%A8/" title="NoSQL数据库入门"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 09-08-2022</div><div class="title">NoSQL数据库入门</div></div></a></div><div><a href="/2022/08/09/DeepLearning-500-questions/%E7%9B%AE%E5%BD%95%E9%A2%84%E8%A7%88/" title="目录预览"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 09-08-2022</div><div class="title">目录预览</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s.gravatar.com/avatar/50de7ee8a1fc96ada7495a641400642d?s=512" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">GreenSeaa</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">154</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">55</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">56</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/yuanweize" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:info@hktse.cz" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://t.me/greenseaa" target="_blank" title=""><i class="fab fa-telegram"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL-%E5%92%8C-MySQL-%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.</span> <span class="toc-text">SQL 和 MySQL 详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL-%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.1.</span> <span class="toc-text">SQL 详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DDL%EF%BC%88%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%E8%AF%AD%E8%A8%80%EF%BC%89"><span class="toc-number">1.1.1.</span> <span class="toc-text">DDL（数据定义语言）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DML%EF%BC%88%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E8%AF%AD%E8%A8%80%EF%BC%89"><span class="toc-number">1.1.2.</span> <span class="toc-text">DML（数据操作语言）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DQL%EF%BC%88%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80%EF%BC%89"><span class="toc-number">1.1.3.</span> <span class="toc-text">DQL（数据查询语言）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DCL%EF%BC%88%E6%95%B0%E6%8D%AE%E6%8E%A7%E5%88%B6%E8%AF%AD%E8%A8%80%EF%BC%89"><span class="toc-number">1.1.4.</span> <span class="toc-text">DCL（数据控制语言）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL-%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.2.</span> <span class="toc-text">MySQL 详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95-2"><span class="toc-number">1.2.1.</span> <span class="toc-text">索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE-2"><span class="toc-number">1.2.2.</span> <span class="toc-text">视图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0-2"><span class="toc-number">1.2.3.</span> <span class="toc-text">函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E7%A8%8B-2"><span class="toc-number">1.2.4.</span> <span class="toc-text">过程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL-%E6%96%B0%E7%89%B9%E6%80%A7-2"><span class="toc-number">1.3.</span> <span class="toc-text">MySQL 新特性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#JSON%E7%B1%BB%E5%9E%8B-2"><span class="toc-number">1.3.1.</span> <span class="toc-text">JSON类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0-2"><span class="toc-number">1.3.2.</span> <span class="toc-text">窗口函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%86%85%E5%AE%B9-2"><span class="toc-number">1.4.</span> <span class="toc-text">其他内容</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8C%83%E5%BC%8F%E7%90%86%E8%AE%BA-2"><span class="toc-number">1.4.1.</span> <span class="toc-text">范式理论</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AE%8C%E6%95%B4%E6%80%A7-2"><span class="toc-number">1.4.2.</span> <span class="toc-text">数据完整性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7-2"><span class="toc-number">1.4.3.</span> <span class="toc-text">数据一致性</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-3"><span class="toc-number">1.5.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/08/09/awesome-cheatsheets/coding_languages/javascript/" title="javascript">javascript</a><time datetime="2022-08-09T18:38:41.000Z" title="发表于 09-08-2022 20:38:41">09-08-2022</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/08/09/awesome-cheatsheets/coding_languages/python/" title="python">python</a><time datetime="2022-08-09T18:38:41.000Z" title="发表于 09-08-2022 20:38:41">09-08-2022</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/08/09/awesome-cheatsheets/coding_languages/vimscript/" title="vimscript">vimscript</a><time datetime="2022-08-09T18:38:41.000Z" title="发表于 09-08-2022 20:38:41">09-08-2022</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/08/09/%E5%85%8D%E8%B4%B9%E7%9A%84%E7%BC%96%E7%A8%8B%E4%B8%AD%E6%96%87%E4%B9%A6%E7%B1%8D%E7%B4%A2%E5%BC%95/" title="免费的编程中文书籍索引">免费的编程中文书籍索引</a><time datetime="2022-08-09T18:31:29.000Z" title="发表于 09-08-2022 20:31:29">09-08-2022</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/08/09/%E7%A8%8B%E5%BA%8F%E5%91%98%E5%BA%94%E8%AF%A5%E9%98%85%E8%AF%BB%E7%9A%84%E9%9D%9E%E7%BC%96%E7%A8%8B%E7%B1%BB%E4%B9%A6%E7%B1%8D%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F/" title="程序员应该阅读的非编程类书籍有哪些？">程序员应该阅读的非编程类书籍有哪些？</a><time datetime="2022-08-09T18:30:32.000Z" title="发表于 09-08-2022 20:30:32">09-08-2022</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By GreenSeaa</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/algoliasearch-lite.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>